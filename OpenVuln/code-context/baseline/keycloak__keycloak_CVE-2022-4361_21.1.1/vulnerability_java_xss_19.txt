# Vulnerability: java/xss
## Message: Cross-site scripting vulnerability due to a [user-provided value](1).

## Code Flow 1

### Thread Flow 1

### Data Flow Step 1: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 198, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
     193:         return true;
     194:     }
     195: 
     196:     private String getOutput() {
     197:         String output = "request-path: ";
>>>  198:         output += httpServletRequest.getServletPath();
     199:         output += "\n";
     200:         output += "principal=";
     201:         Principal principal = httpServletRequest.getUserPrincipal();
     202: 
     203:         if (principal == null) {
```

### Data Flow Step 2: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 204, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
     199:         output += "\n";
     200:         output += "principal=";
     201:         Principal principal = httpServletRequest.getUserPrincipal();
     202: 
     203:         if (principal == null) {
>>>  204:             return output + "null";
     205:         }
     206: 
     207:         sentPrincipal = principal;
     208: 
     209:         output += principal.getName() + "\n";
```

### Data Flow Step 3: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 28
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 4: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 5: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 6: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 7: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 137, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
     132: 
     133:     @POST
     134:     @Path("{path}")
     135:     public Response doPostElseWhere(@PathParam("path") String path, @QueryParam("checkRoles") boolean checkRolesFlag) throws IOException {
     136:         System.out.println("In SendUsername Servlet doPostElseWhere() - path: " + path);
>>>  137:         return doPost(checkRolesFlag);
     138:     }
     139: 
     140:     @POST
     141:     @Path("error.html")
     142:     public Response errorPagePost() {
```

## Code Flow 2

### Thread Flow 1

### Data Flow Step 1: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 198, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
     193:         return true;
     194:     }
     195: 
     196:     private String getOutput() {
     197:         String output = "request-path: ";
>>>  198:         output += httpServletRequest.getServletPath();
     199:         output += "\n";
     200:         output += "principal=";
     201:         Principal principal = httpServletRequest.getUserPrincipal();
     202: 
     203:         if (principal == null) {
```

### Data Flow Step 2: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 213, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
     208: 
     209:         output += principal.getName() + "\n";
     210:         output += getSessionInfo() + "\n";
     211:         output += getRoles() + "\n";
     212: 
>>>  213:         return output;
     214:     }
     215: 
     216:     private String getSessionInfo() {
     217:         HttpSession session = httpServletRequest.getSession(false);
     218: 
```

### Data Flow Step 3: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 28
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 4: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 5: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 6: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 93, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
      88: 
      89:         if (httpServletRequest.getUserPrincipal() != null && (checkRolesFlag || checkRoles) && !checkRoles()) {
      90:             throw new RuntimeException("User: " + httpServletRequest.getUserPrincipal() + " do not have required role");
      91:         }
      92: 
>>>   93:         return Response.ok(getOutput()).header(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_HTML_TYPE + ";charset=UTF-8").build();
      94: 
      95:     }
      96: 
      97:     @GET
      98:     @Path("getAttributes")
```

### Data Flow Step 7: testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java, Line 137, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/SendUsernameServlet.java
```java
     132: 
     133:     @POST
     134:     @Path("{path}")
     135:     public Response doPostElseWhere(@PathParam("path") String path, @QueryParam("checkRoles") boolean checkRolesFlag) throws IOException {
     136:         System.out.println("In SendUsername Servlet doPostElseWhere() - path: " + path);
>>>  137:         return doPost(checkRolesFlag);
     138:     }
     139: 
     140:     @POST
     141:     @Path("error.html")
     142:     public Response errorPagePost() {
```
