# Vulnerability: java/xss
## Message: Cross-site scripting vulnerability due to a [user-provided value](1).

## Code Flow 1

### Thread Flow 1

### Data Flow Step 1: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 199, Column 22
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     194:     public static String safeGetQueryString( final HttpServletRequest request, final Charset contentEncoding ) {
     195:         if( request == null ) {
     196:             return "";
     197:         }
     198: 
>>>  199:         String res = request.getQueryString();
     200:         if( res != null ) {
     201:             res = new String( res.getBytes( StandardCharsets.ISO_8859_1 ), contentEncoding );
     202: 
     203:             //
     204:             // Ensure that the 'page=xyz' attribute is removed
```

### Data Flow Step 2: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 218, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     213:                 }
     214:                 res = tmpRes;
     215:             }
     216:         }
     217: 
>>>  218:         return res;
     219:     }
     220: 
     221:     /**
     222:      * Verifies whether a String represents an IPv4 address. The algorithm is extremely efficient and does not allocate any objects.
     223:      *
```

### Data Flow Step 3: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 280, Column 36
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     275:         nextCal.add(Calendar.MONTH, 1);  // Now move to first day of next month
     276: 
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
>>>  280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
     281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
```

### Data Flow Step 4: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 282, Column 57
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
     280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
     281:         out.write( "<tr>"+
>>>  282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
     286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
     287:                    "</tr>\n"
```

### Data Flow Step 5: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 192, Column 76
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     187:         }
     188: 
     189:         return format( result );
     190:     }
     191: 
>>>  192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
     194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
```

### Data Flow Step 6: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 194, Column 49
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     189:         return format( result );
     190:     }
     191: 
     192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
>>>  194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
     198:         nextMonth.add( Calendar.MONTH, 1 ); // Now move to 1st day of next month
     199: 
```

### Data Flow Step 7: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 214, Column 43
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     209:      *
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
>>>  214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
```

### Data Flow Step 8: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 215, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
>>>  215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
```

### Data Flow Step 9: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 10: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 11: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 215, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
>>>  215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
```

### Data Flow Step 12: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 216, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
>>>  216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
```

### Data Flow Step 13: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 14: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 15: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 216, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
>>>  216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
```

### Data Flow Step 16: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 217, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
>>>  217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
```

### Data Flow Step 17: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 18: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 19: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 217, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
>>>  217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
```

### Data Flow Step 20: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 218, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
>>>  218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
     223:     /**
```

### Data Flow Step 21: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 22: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 23: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 218, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
>>>  218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
     223:     /**
```

### Data Flow Step 24: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 220, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
>>>  220:         return src;
     221:     }
     222: 
     223:     /**
     224:      *  Replaces a string with another string.
     225:      *
```

### Data Flow Step 25: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 194, Column 23
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     189:         return format( result );
     190:     }
     191: 
     192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
>>>  194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
     198:         nextMonth.add( Calendar.MONTH, 1 ); // Now move to 1st day of next month
     199: 
```

### Data Flow Step 26: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 237, Column 24
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     232:             result = "<td><a href=\""+url+"\">"+txt+"</a></td>";
     233:         } else {
     234:             result="<td> </td>";
     235:         }
     236: 
>>>  237:         return format( result );
     238:     }
     239: 
     240:     /**
     241:      *  {@inheritDoc}
     242:      */
```

### Data Flow Step 27: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 130, Column 28
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     125:     public void setMonthurlformat( final String format )
     126:     {
     127:         m_monthUrlFormat = new SimpleDateFormat( format );
     128:     }
     129: 
>>>  130:     private String format( final String txt ) {
     131:         final Page p = m_wikiContext.getPage();
     132:         if( p != null ) {
     133:             return TextUtil.replaceString( txt, "%p", p.getName() );
     134:         }
     135: 
```

### Data Flow Step 28: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 136, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     131:         final Page p = m_wikiContext.getPage();
     132:         if( p != null ) {
     133:             return TextUtil.replaceString( txt, "%p", p.getName() );
     134:         }
     135: 
>>>  136:         return txt;
     137:     }
     138: 
     139:     /**
     140:      *  Returns a link to the given day.
     141:      */
```

### Data Flow Step 29: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 237, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     232:             result = "<td><a href=\""+url+"\">"+txt+"</a></td>";
     233:         } else {
     234:             result="<td> </td>";
     235:         }
     236: 
>>>  237:         return format( result );
     238:     }
     239: 
     240:     /**
     241:      *  {@inheritDoc}
     242:      */
```

### Data Flow Step 30: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 282, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
     280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
     281:         out.write( "<tr>"+
>>>  282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
     286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
     287:                    "</tr>\n"
```

### Data Flow Step 31: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 281, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     276: 
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
     280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
>>>  281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
     286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
```

## Code Flow 2

### Thread Flow 1

### Data Flow Step 1: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 199, Column 22
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     194:     public static String safeGetQueryString( final HttpServletRequest request, final Charset contentEncoding ) {
     195:         if( request == null ) {
     196:             return "";
     197:         }
     198: 
>>>  199:         String res = request.getQueryString();
     200:         if( res != null ) {
     201:             res = new String( res.getBytes( StandardCharsets.ISO_8859_1 ), contentEncoding );
     202: 
     203:             //
     204:             // Ensure that the 'page=xyz' attribute is removed
```

### Data Flow Step 2: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 201, Column 31
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     196:             return "";
     197:         }
     198: 
     199:         String res = request.getQueryString();
     200:         if( res != null ) {
>>>  201:             res = new String( res.getBytes( StandardCharsets.ISO_8859_1 ), contentEncoding );
     202: 
     203:             //
     204:             // Ensure that the 'page=xyz' attribute is removed
     205:             // FIXME: Is it really the mandate of this routine to do that?
     206:             //
```

### Data Flow Step 3: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 201, Column 31
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     196:             return "";
     197:         }
     198: 
     199:         String res = request.getQueryString();
     200:         if( res != null ) {
>>>  201:             res = new String( res.getBytes( StandardCharsets.ISO_8859_1 ), contentEncoding );
     202: 
     203:             //
     204:             // Ensure that the 'page=xyz' attribute is removed
     205:             // FIXME: Is it really the mandate of this routine to do that?
     206:             //
```

### Data Flow Step 4: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 201, Column 19
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     196:             return "";
     197:         }
     198: 
     199:         String res = request.getQueryString();
     200:         if( res != null ) {
>>>  201:             res = new String( res.getBytes( StandardCharsets.ISO_8859_1 ), contentEncoding );
     202: 
     203:             //
     204:             // Ensure that the 'page=xyz' attribute is removed
     205:             // FIXME: Is it really the mandate of this routine to do that?
     206:             //
```

### Data Flow Step 5: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 218, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     213:                 }
     214:                 res = tmpRes;
     215:             }
     216:         }
     217: 
>>>  218:         return res;
     219:     }
     220: 
     221:     /**
     222:      * Verifies whether a String represents an IPv4 address. The algorithm is extremely efficient and does not allocate any objects.
     223:      *
```

### Data Flow Step 6: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 280, Column 36
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     275:         nextCal.add(Calendar.MONTH, 1);  // Now move to first day of next month
     276: 
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
>>>  280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
     281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
```

### Data Flow Step 7: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 286, Column 57
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
>>>  286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
     287:                    "</tr>\n"
     288:                  );
     289: 
     290:         final int month = cal.get( Calendar.MONTH );
     291:         cal.set( Calendar.DAY_OF_WEEK, Calendar.MONDAY ); // Then, find the first day of the week.
```

### Data Flow Step 8: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 192, Column 76
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     187:         }
     188: 
     189:         return format( result );
     190:     }
     191: 
>>>  192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
     194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
```

### Data Flow Step 9: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 194, Column 49
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     189:         return format( result );
     190:     }
     191: 
     192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
>>>  194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
     198:         nextMonth.add( Calendar.MONTH, 1 ); // Now move to 1st day of next month
     199: 
```

### Data Flow Step 10: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 214, Column 43
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     209:      *
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
>>>  214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
```

### Data Flow Step 11: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 215, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
>>>  215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
```

### Data Flow Step 12: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 13: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 25
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 14: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 13
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 15: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 16: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 17: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 215, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
>>>  215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
```

### Data Flow Step 18: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 216, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
>>>  216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
```

### Data Flow Step 19: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 20: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 25
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 21: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 13
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 22: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 23: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 24: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 216, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
>>>  216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
```

### Data Flow Step 25: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 217, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
>>>  217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
```

### Data Flow Step 26: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 27: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 25
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 28: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 13
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 29: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 30: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 31: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 217, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
>>>  217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
```

### Data Flow Step 32: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 218, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
>>>  218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
     223:     /**
```

### Data Flow Step 33: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 34: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 25
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 35: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 13
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 36: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 37: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 38: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 218, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
>>>  218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
     223:     /**
```

### Data Flow Step 39: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 220, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
>>>  220:         return src;
     221:     }
     222: 
     223:     /**
     224:      *  Replaces a string with another string.
     225:      *
```

### Data Flow Step 40: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 194, Column 23
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     189:         return format( result );
     190:     }
     191: 
     192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
>>>  194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
     198:         nextMonth.add( Calendar.MONTH, 1 ); // Now move to 1st day of next month
     199: 
```

### Data Flow Step 41: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 218, Column 34
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     213:                 //        routines for this.  Will fail if it's not calendar.date
     214:                 //        but something else.
     215: 
     216:                 final int pos1 = queryString.indexOf("calendar.date=");
     217:                 if( pos1 >= 0 ) {
>>>  218:                     String tmp = queryString.substring( 0, pos1 );
     219:                     // FIXME: Will this fail when we use & instead of &amp?
     220:                     // FIXME: should use some parsing routine
     221:                     final int pos2 = queryString.indexOf("&", pos1 ) + 1;
     222:                     if ( ( pos2 > 0 ) && ( pos2 < queryStringLlength ) ) {
     223:                         tmp = tmp + queryString.substring(pos2);
```

### Data Flow Step 42: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 218, Column 34
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     213:                 //        routines for this.  Will fail if it's not calendar.date
     214:                 //        but something else.
     215: 
     216:                 final int pos1 = queryString.indexOf("calendar.date=");
     217:                 if( pos1 >= 0 ) {
>>>  218:                     String tmp = queryString.substring( 0, pos1 );
     219:                     // FIXME: Will this fail when we use & instead of &amp?
     220:                     // FIXME: should use some parsing routine
     221:                     final int pos2 = queryString.indexOf("&", pos1 ) + 1;
     222:                     if ( ( pos2 > 0 ) && ( pos2 < queryStringLlength ) ) {
     223:                         tmp = tmp + queryString.substring(pos2);
```

### Data Flow Step 43: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 237, Column 24
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     232:             result = "<td><a href=\""+url+"\">"+txt+"</a></td>";
     233:         } else {
     234:             result="<td> </td>";
     235:         }
     236: 
>>>  237:         return format( result );
     238:     }
     239: 
     240:     /**
     241:      *  {@inheritDoc}
     242:      */
```

### Data Flow Step 44: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 130, Column 28
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     125:     public void setMonthurlformat( final String format )
     126:     {
     127:         m_monthUrlFormat = new SimpleDateFormat( format );
     128:     }
     129: 
>>>  130:     private String format( final String txt ) {
     131:         final Page p = m_wikiContext.getPage();
     132:         if( p != null ) {
     133:             return TextUtil.replaceString( txt, "%p", p.getName() );
     134:         }
     135: 
```

### Data Flow Step 45: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 133, Column 44
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     128:     }
     129: 
     130:     private String format( final String txt ) {
     131:         final Page p = m_wikiContext.getPage();
     132:         if( p != null ) {
>>>  133:             return TextUtil.replaceString( txt, "%p", p.getName() );
     134:         }
     135: 
     136:         return txt;
     137:     }
     138: 
```

### Data Flow Step 46: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 47: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 25
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 48: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 248, Column 13
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     243:         int start;
     244:         int end = 0;
     245:         int last = 0;
     246: 
     247:         while ( ( start = orig.indexOf( src,end ) ) != -1 ) {
>>>  248:             res.append( orig, last, start );
     249:             res.append( dest );
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
```

### Data Flow Step 49: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 50: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 255, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     250:             end  = start + src.length();
     251:             last = start + src.length();
     252:         }
     253:         res.append( orig.substring( end ) );
     254: 
>>>  255:         return res.toString();
     256:     }
     257: 
     258:     /**
     259:      *  Replaces a part of a string with a new String.
     260:      *
```

### Data Flow Step 51: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 133, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     128:     }
     129: 
     130:     private String format( final String txt ) {
     131:         final Page p = m_wikiContext.getPage();
     132:         if( p != null ) {
>>>  133:             return TextUtil.replaceString( txt, "%p", p.getName() );
     134:         }
     135: 
     136:         return txt;
     137:     }
     138: 
```

### Data Flow Step 52: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 237, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     232:             result = "<td><a href=\""+url+"\">"+txt+"</a></td>";
     233:         } else {
     234:             result="<td> </td>";
     235:         }
     236: 
>>>  237:         return format( result );
     238:     }
     239: 
     240:     /**
     241:      *  {@inheritDoc}
     242:      */
```

### Data Flow Step 53: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 286, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
>>>  286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
     287:                    "</tr>\n"
     288:                  );
     289: 
     290:         final int month = cal.get( Calendar.MONTH );
     291:         cal.set( Calendar.DAY_OF_WEEK, Calendar.MONDAY ); // Then, find the first day of the week.
```

### Data Flow Step 54: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 281, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     276: 
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
     280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
>>>  281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
     286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
```

## Code Flow 3

### Thread Flow 1

### Data Flow Step 1: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 199, Column 22
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     194:     public static String safeGetQueryString( final HttpServletRequest request, final Charset contentEncoding ) {
     195:         if( request == null ) {
     196:             return "";
     197:         }
     198: 
>>>  199:         String res = request.getQueryString();
     200:         if( res != null ) {
     201:             res = new String( res.getBytes( StandardCharsets.ISO_8859_1 ), contentEncoding );
     202: 
     203:             //
     204:             // Ensure that the 'page=xyz' attribute is removed
```

### Data Flow Step 2: jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java, Line 218, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/HttpUtil.java
```java
     213:                 }
     214:                 res = tmpRes;
     215:             }
     216:         }
     217: 
>>>  218:         return res;
     219:     }
     220: 
     221:     /**
     222:      * Verifies whether a String represents an IPv4 address. The algorithm is extremely efficient and does not allocate any objects.
     223:      *
```

### Data Flow Step 3: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 280, Column 36
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     275:         nextCal.add(Calendar.MONTH, 1);  // Now move to first day of next month
     276: 
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
>>>  280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
     281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
```

### Data Flow Step 4: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 282, Column 57
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
     280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
     281:         out.write( "<tr>"+
>>>  282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
     286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
     287:                    "</tr>\n"
```

### Data Flow Step 5: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 192, Column 76
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     187:         }
     188: 
     189:         return format( result );
     190:     }
     191: 
>>>  192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
     194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
```

### Data Flow Step 6: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 194, Column 49
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     189:         return format( result );
     190:     }
     191: 
     192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
>>>  194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
     198:         nextMonth.add( Calendar.MONTH, 1 ); // Now move to 1st day of next month
     199: 
```

### Data Flow Step 7: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 214, Column 43
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     209:      *
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
>>>  214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
```

### Data Flow Step 8: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 215, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
>>>  215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
```

### Data Flow Step 9: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 10: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 11: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 215, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     210:      *  @since 1.6.1
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
>>>  215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
```

### Data Flow Step 12: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 216, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
>>>  216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
```

### Data Flow Step 13: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 14: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 15: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 216, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     211:      *  @param src The source string.
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
>>>  216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
```

### Data Flow Step 16: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 217, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
>>>  217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
```

### Data Flow Step 17: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 18: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 19: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 217, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     212:      *  @return The encoded string.
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
>>>  217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
```

### Data Flow Step 20: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 218, Column 30
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
>>>  218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
     223:     /**
```

### Data Flow Step 21: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 231, Column 41
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     226:      *  @param orig Original string.  Null is safe.
     227:      *  @param src  The string to find.
     228:      *  @param dest The string to replace <I>src</I> with.
     229:      *  @return A string with the replacement done.
     230:      */
>>>  231:     public static String replaceString( final String orig, final String src, final String dest ) {
     232:         if ( orig == null ) {
     233:             return null;
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
```

### Data Flow Step 22: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 239, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     234:         }
     235:         if ( src == null || dest == null ) {
     236:             throw new NullPointerException();
     237:         }
     238:         if ( src.isEmpty() ) {
>>>  239:             return orig;
     240:         }
     241: 
     242:         final StringBuilder res = new StringBuilder( orig.length() + 20 ); // Pure guesswork
     243:         int start;
     244:         int end = 0;
```

### Data Flow Step 23: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 218, Column 15
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     213:      */
     214:     public static String replaceEntities( String src ) {
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
>>>  218:         src = replaceString( src, "\"", "&quot;" );
     219: 
     220:         return src;
     221:     }
     222: 
     223:     /**
```

### Data Flow Step 24: jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java, Line 220, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-util/src/main/java/org/apache/wiki/util/TextUtil.java
```java
     215:         src = replaceString( src, "&", "&amp;" );
     216:         src = replaceString( src, "<", "&lt;" );
     217:         src = replaceString( src, ">", "&gt;" );
     218:         src = replaceString( src, "\"", "&quot;" );
     219: 
>>>  220:         return src;
     221:     }
     222: 
     223:     /**
     224:      *  Replaces a string with another string.
     225:      *
```

### Data Flow Step 25: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 194, Column 23
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     189:         return format( result );
     190:     }
     191: 
     192:     private String getMonthNaviLink( final Calendar day, final String txt, String queryString ) {
     193:         final String result;
>>>  194:         queryString = TextUtil.replaceEntities( queryString );
     195:         final Calendar nextMonth = Calendar.getInstance();
     196:         nextMonth.set( Calendar.DATE, 1 );
     197:         nextMonth.add( Calendar.DATE, -1);
     198:         nextMonth.add( Calendar.MONTH, 1 ); // Now move to 1st day of next month
     199: 
```

### Data Flow Step 26: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 223, Column 37
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     218:                     String tmp = queryString.substring( 0, pos1 );
     219:                     // FIXME: Will this fail when we use & instead of &amp?
     220:                     // FIXME: should use some parsing routine
     221:                     final int pos2 = queryString.indexOf("&", pos1 ) + 1;
     222:                     if ( ( pos2 > 0 ) && ( pos2 < queryStringLlength ) ) {
>>>  223:                         tmp = tmp + queryString.substring(pos2);
     224:                     }
     225:                     queryString = tmp;
     226:                 }
     227: 
     228:                 if( queryStringLlength > 0 ) {
```

### Data Flow Step 27: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 223, Column 37
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     218:                     String tmp = queryString.substring( 0, pos1 );
     219:                     // FIXME: Will this fail when we use & instead of &amp?
     220:                     // FIXME: should use some parsing routine
     221:                     final int pos2 = queryString.indexOf("&", pos1 ) + 1;
     222:                     if ( ( pos2 > 0 ) && ( pos2 < queryStringLlength ) ) {
>>>  223:                         tmp = tmp + queryString.substring(pos2);
     224:                     }
     225:                     queryString = tmp;
     226:                 }
     227: 
     228:                 if( queryStringLlength > 0 ) {
```

### Data Flow Step 28: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 237, Column 24
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     232:             result = "<td><a href=\""+url+"\">"+txt+"</a></td>";
     233:         } else {
     234:             result="<td> </td>";
     235:         }
     236: 
>>>  237:         return format( result );
     238:     }
     239: 
     240:     /**
     241:      *  {@inheritDoc}
     242:      */
```

### Data Flow Step 29: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 130, Column 28
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     125:     public void setMonthurlformat( final String format )
     126:     {
     127:         m_monthUrlFormat = new SimpleDateFormat( format );
     128:     }
     129: 
>>>  130:     private String format( final String txt ) {
     131:         final Page p = m_wikiContext.getPage();
     132:         if( p != null ) {
     133:             return TextUtil.replaceString( txt, "%p", p.getName() );
     134:         }
     135: 
```

### Data Flow Step 30: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 136, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     131:         final Page p = m_wikiContext.getPage();
     132:         if( p != null ) {
     133:             return TextUtil.replaceString( txt, "%p", p.getName() );
     134:         }
     135: 
>>>  136:         return txt;
     137:     }
     138: 
     139:     /**
     140:      *  Returns a link to the given day.
     141:      */
```

### Data Flow Step 31: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 237, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     232:             result = "<td><a href=\""+url+"\">"+txt+"</a></td>";
     233:         } else {
     234:             result="<td> </td>";
     235:         }
     236: 
>>>  237:         return format( result );
     238:     }
     239: 
     240:     /**
     241:      *  {@inheritDoc}
     242:      */
```

### Data Flow Step 32: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 282, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
     280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
     281:         out.write( "<tr>"+
>>>  282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
     286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
     287:                    "</tr>\n"
```

### Data Flow Step 33: jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java, Line 281, Column 20
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/tags/CalendarTag.java
```java
     276: 
     277:         out.write( "<table class=\"calendar\">\n" );
     278: 
     279:         final HttpServletRequest httpServletRequest = m_wikiContext.getHttpRequest();
     280:         final String queryString = HttpUtil.safeGetQueryString( httpServletRequest, engine.getContentEncoding() );
>>>  281:         out.write( "<tr>"+
     282:                    getMonthNaviLink(prevCal,"&lt;&lt;", queryString)+
     283:                    "<td colspan=5 class=\"month\">"+
     284:                    getMonthLink( cal )+
     285:                    "</td>"+
     286:                    getMonthNaviLink(nextCal,"&gt;&gt;", queryString)+
```
