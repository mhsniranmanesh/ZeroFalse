# Vulnerability: java/xss
## Message: Cross-site scripting vulnerability due to a [user-provided value](1).

## Code Flow 1

### Thread Flow 1

### Data Flow Step 1: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 73
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
     130:             if( container != null ) {
     131:                 final WikiAjaxServlet servlet = container.servlet;
     132:                 if ( validatePermission( req, container ) ) {
     133:                     req.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
     134:                     res.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
     136:                     LOG.debug( "actionName=" + actionName );
     137:                     final String params = req.getParameter( "params" );
     138:                     LOG.debug( "params=" + params );
     139:                     List< String > paramValues = new ArrayList<>();
     140:                     if( params != null ) {
```

### Data Flow Step 2: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 61, Column 40
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      56: 	 * @param path the RequestURI to search usually done by calling request.getRequestUri().
      57: 	 * @param lastPart the previousPart of the path to search after.
      58: 	 * @return the next part of the path.
      59: 	 * @throws ServletException if {@code path} does not contain {@code lastPart}
      60: 	 */
>>>   61: 	public static String getNextPathPart( String path, String lastPart ) throws ServletException {
      62:         if( StringUtils.isBlank( path ) ) {
      63: 			return null;
      64: 		}
      65: 		if( !lastPart.endsWith( "/" ) ) {
      66: 			lastPart += "/";
```

### Data Flow Step 3: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      72: 			index = path.indexOf( lastPart );
      73: 			if( index < 0 ) {
      74: 				throw new ServletException( "Invalid path provided " + path + " does not contain '" + lastPart + "'" );
      75: 			}
      76: 		}
>>>   77: 		path = path.substring( index + lastPartLength );
      78: 		index = path.indexOf( "/" );
      79: 		if( index == -1 ) {
      80: 			index = path.indexOf( "#" );
      81: 			if( index == -1 ) {
      82: 				index = path.indexOf( "?" );
```

### Data Flow Step 4: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      72: 			index = path.indexOf( lastPart );
      73: 			if( index < 0 ) {
      74: 				throw new ServletException( "Invalid path provided " + path + " does not contain '" + lastPart + "'" );
      75: 			}
      76: 		}
>>>   77: 		path = path.substring( index + lastPartLength );
      78: 		index = path.indexOf( "/" );
      79: 		if( index == -1 ) {
      80: 			index = path.indexOf( "#" );
      81: 			if( index == -1 ) {
      82: 				index = path.indexOf( "?" );
```

### Data Flow Step 5: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 93, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      88: 			result = path;
      89:         } else {
      90:             result = path.substring( 0, index );
      91:         }
      92: 
>>>   93:         return result;
      94:     }
      95: 
      96: }
```

### Data Flow Step 6: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 47
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
     130:             if( container != null ) {
     131:                 final WikiAjaxServlet servlet = container.servlet;
     132:                 if ( validatePermission( req, container ) ) {
     133:                     req.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
     134:                     res.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
     136:                     LOG.debug( "actionName=" + actionName );
     137:                     final String params = req.getParameter( "params" );
     138:                     LOG.debug( "params=" + params );
     139:                     List< String > paramValues = new ArrayList<>();
     140:                     if( params != null ) {
```

### Data Flow Step 7: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 145, Column 48
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
     140:                     if( params != null ) {
     141:                         if( StringUtils.isNotBlank( params ) ) {
     142:                             paramValues = Arrays.asList( params.trim().split( "," ) );
     143:                         }
     144:                     }
>>>  145:                     servlet.service( req, res, actionName, paramValues );
     146:                 } else {
     147:                     LOG.warn( "Servlet container " + container + " not authorised. Permission required." );
     148:                 }
     149:             } else {
     150:                 LOG.error( "No registered class for servletName=" + servletName + " in path=" + path );
```

### Data Flow Step 8: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 53, Column 93
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
      48: 	public String getServletMapping() {
      49: 		return SERVLET_MAPPING;
      50: 	}
      51: 
      52: 	@Override
>>>   53: 	public void service( final HttpServletRequest request, final HttpServletResponse response, final String actionName, final List< String > params )
      54: 			throws ServletException, IOException {
      55: 		try {
      56: 			Thread.sleep( 5000 ); // Wait 5 seconds
      57: 		} catch( final Exception e ) {
      58: 		}
```

### Data Flow Step 9: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 59, Column 31
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
      54: 			throws ServletException, IOException {
      55: 		try {
      56: 			Thread.sleep( 5000 ); // Wait 5 seconds
      57: 		} catch( final Exception e ) {
      58: 		}
>>>   59: 		response.getWriter().print( "You called! actionName=" + actionName + " params=" + params );
      60: 	}
      61: 
      62: }
```

## Code Flow 2

### Thread Flow 1

### Data Flow Step 1: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 73
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
     130:             if( container != null ) {
     131:                 final WikiAjaxServlet servlet = container.servlet;
     132:                 if ( validatePermission( req, container ) ) {
     133:                     req.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
     134:                     res.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
     136:                     LOG.debug( "actionName=" + actionName );
     137:                     final String params = req.getParameter( "params" );
     138:                     LOG.debug( "params=" + params );
     139:                     List< String > paramValues = new ArrayList<>();
     140:                     if( params != null ) {
```

### Data Flow Step 2: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 61, Column 40
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      56: 	 * @param path the RequestURI to search usually done by calling request.getRequestUri().
      57: 	 * @param lastPart the previousPart of the path to search after.
      58: 	 * @return the next part of the path.
      59: 	 * @throws ServletException if {@code path} does not contain {@code lastPart}
      60: 	 */
>>>   61: 	public static String getNextPathPart( String path, String lastPart ) throws ServletException {
      62:         if( StringUtils.isBlank( path ) ) {
      63: 			return null;
      64: 		}
      65: 		if( !lastPart.endsWith( "/" ) ) {
      66: 			lastPart += "/";
```

### Data Flow Step 3: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      72: 			index = path.indexOf( lastPart );
      73: 			if( index < 0 ) {
      74: 				throw new ServletException( "Invalid path provided " + path + " does not contain '" + lastPart + "'" );
      75: 			}
      76: 		}
>>>   77: 		path = path.substring( index + lastPartLength );
      78: 		index = path.indexOf( "/" );
      79: 		if( index == -1 ) {
      80: 			index = path.indexOf( "#" );
      81: 			if( index == -1 ) {
      82: 				index = path.indexOf( "?" );
```

### Data Flow Step 4: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      72: 			index = path.indexOf( lastPart );
      73: 			if( index < 0 ) {
      74: 				throw new ServletException( "Invalid path provided " + path + " does not contain '" + lastPart + "'" );
      75: 			}
      76: 		}
>>>   77: 		path = path.substring( index + lastPartLength );
      78: 		index = path.indexOf( "/" );
      79: 		if( index == -1 ) {
      80: 			index = path.indexOf( "#" );
      81: 			if( index == -1 ) {
      82: 				index = path.indexOf( "?" );
```

### Data Flow Step 5: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 90, Column 22
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      85: 
      86: 		final String result;
      87: 		if( index == -1 ) {
      88: 			result = path;
      89:         } else {
>>>   90:             result = path.substring( 0, index );
      91:         }
      92: 
      93:         return result;
      94:     }
      95: 
```

### Data Flow Step 6: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 90, Column 22
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      85: 
      86: 		final String result;
      87: 		if( index == -1 ) {
      88: 			result = path;
      89:         } else {
>>>   90:             result = path.substring( 0, index );
      91:         }
      92: 
      93:         return result;
      94:     }
      95: 
```

### Data Flow Step 7: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 93, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
      88: 			result = path;
      89:         } else {
      90:             result = path.substring( 0, index );
      91:         }
      92: 
>>>   93:         return result;
      94:     }
      95: 
      96: }
```

### Data Flow Step 8: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 47
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
     130:             if( container != null ) {
     131:                 final WikiAjaxServlet servlet = container.servlet;
     132:                 if ( validatePermission( req, container ) ) {
     133:                     req.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
     134:                     res.setCharacterEncoding( m_engine.getContentEncoding().displayName() );
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
     136:                     LOG.debug( "actionName=" + actionName );
     137:                     final String params = req.getParameter( "params" );
     138:                     LOG.debug( "params=" + params );
     139:                     List< String > paramValues = new ArrayList<>();
     140:                     if( params != null ) {
```

### Data Flow Step 9: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 145, Column 48
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
     140:                     if( params != null ) {
     141:                         if( StringUtils.isNotBlank( params ) ) {
     142:                             paramValues = Arrays.asList( params.trim().split( "," ) );
     143:                         }
     144:                     }
>>>  145:                     servlet.service( req, res, actionName, paramValues );
     146:                 } else {
     147:                     LOG.warn( "Servlet container " + container + " not authorised. Permission required." );
     148:                 }
     149:             } else {
     150:                 LOG.error( "No registered class for servletName=" + servletName + " in path=" + path );
```

### Data Flow Step 10: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 53, Column 93
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
      48: 	public String getServletMapping() {
      49: 		return SERVLET_MAPPING;
      50: 	}
      51: 
      52: 	@Override
>>>   53: 	public void service( final HttpServletRequest request, final HttpServletResponse response, final String actionName, final List< String > params )
      54: 			throws ServletException, IOException {
      55: 		try {
      56: 			Thread.sleep( 5000 ); // Wait 5 seconds
      57: 		} catch( final Exception e ) {
      58: 		}
```

### Data Flow Step 11: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 59, Column 31
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
      54: 			throws ServletException, IOException {
      55: 		try {
      56: 			Thread.sleep( 5000 ); // Wait 5 seconds
      57: 		} catch( final Exception e ) {
      58: 		}
>>>   59: 		response.getWriter().print( "You called! actionName=" + actionName + " params=" + params );
      60: 	}
      61: 
      62: }
```
