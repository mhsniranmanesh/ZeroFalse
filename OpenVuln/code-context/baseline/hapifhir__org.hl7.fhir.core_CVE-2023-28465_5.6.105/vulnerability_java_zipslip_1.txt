# Vulnerability: java/zipslip
## Message: Unsanitized archive entry, which may contain '..', is used in a [file system operation](1).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](2).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](3).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](4).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](5).

## Code Flow 1

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     404: 
     405:       int i = 0;
     406:       int c = 12;
     407:       while ((entry = (TarArchiveEntry) tarIn.getNextEntry()) != null) {
     408:         i++;
>>>  409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
     398:       gzipIn = new GzipCompressorInputStream(tgz);
     399:     } catch (Exception e) {
     400:       throw new IOException("Error reading "+(desc == null ? "package" : desc)+": "+e.getMessage(), e);
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     386:     return fromPackage(tgz, desc, false);
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
>>>  391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
>>>  392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 370, Column 22
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     365:     if (progress) {
     366:       log("Installing " + id + "#" + (version == null ? "?" : version) + " to the package cache");
     367:       log("  Fetching:");
     368:     }
     369: 
>>>  370:     NpmPackage npm = NpmPackage.fromPackage(packageTgzInputStream, sourceDesc, true);
     371: 
     372:     if (progress) {
     373:       log("");
     374:       logn("  Installing: ");
     375:     }
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 925, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     920:       if (!lockFile.isFile()) {
     921:         TextFile.stringToFile("", lockFile);
     922:       }
     923:     }
     924: 
>>>  925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
     930:           result = f.get();
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 930, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
>>>  930:           result = f.get();
     931:         } finally {
     932:           fileLock.release();
     933:         }
     934:         if (!lockFile.delete()) {
     935:           lockFile.deleteOnExit();
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 16: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 17: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 18: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 880, Column 40
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     875:     }
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
>>>  880:   public Map<String, NpmPackageFolder> getFolders() {
     881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
```

### Data Flow Step 19: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
     880:   public Map<String, NpmPackageFolder> getFolders() {
>>>  881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
     886:     if (!dir.exists()) {
```

### Data Flow Step 20: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
     880:   public Map<String, NpmPackageFolder> getFolders() {
>>>  881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
     886:     if (!dir.exists()) {
```

### Data Flow Step 21: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 22: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 26
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     612:     s.append(src);
     613:     return s.toString();
     614:   }
     615: 
     616: 
>>>  617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
     622:       if (first && arg == null)
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     616: 
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
>>>  621:     for (String arg : args) {
     622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
>>>  622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 405, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
>>>  405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
     409:               TextFile.bytesToFile(cnt, fn);
     410:               size = size + cnt.length;
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 444, Column 38
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     439:           }
     440:       }
     441:     }
     442:   }
     443: 
>>>  444:   public static File createDirectory(String path) throws IOException {
     445:     new CSFile(path).mkdirs();
     446:     return new File(path);
     447:   }
     448: 
     449:   public static String changeFileExt(String name, String ext) {
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 445, Column 16
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     440:       }
     441:     }
     442:   }
     443: 
     444:   public static File createDirectory(String path) throws IOException {
>>>  445:     new CSFile(path).mkdirs();
     446:     return new File(path);
     447:   }
     448: 
     449:   public static String changeFileExt(String name, String ext) {
     450:     if (name.lastIndexOf('.') > -1)
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      42:  *
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
>>>   47:   public CSFile(String pathname) throws IOException {
      48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
      47:   public CSFile(String pathname) throws IOException {
>>>   48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
      53: //      File f = new File(getParent());
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
      47:   public CSFile(String pathname) throws IOException {
>>>   48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
      53: //      File f = new File(getParent());
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 66, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      61: //        throw new Error("Case mismatch of file "+ pathname);
      62: //    }
      63: 
      64:     //EK: Original code above looked extremely wasteful: every single
      65:     //attempt to open a file triggers a directory listing
>>>   66:     if (exists())
      67:     {
      68:     	if(!this.getCanonicalFile().getName().equals(this.getName()))
      69:     		throw new Error("Case mismatch of file "+ pathname+": found "+this.getCanonicalFile().getName());
      70:     }
      71:   }
```

## Code Flow 2

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     404: 
     405:       int i = 0;
     406:       int c = 12;
     407:       while ((entry = (TarArchiveEntry) tarIn.getNextEntry()) != null) {
     408:         i++;
>>>  409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 49
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 169, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     164:     private Map<String, List<String>> types = new HashMap<>();
     165:     private Map<String, byte[]> content = new HashMap<>();
     166:     private JsonObject index;
     167:     private File folder;
     168: 
>>>  169:     public NpmPackageFolder(String name) {
     170:       super();
     171:       this.name = name;
     172:     }
     173: 
     174:     public Map<String, List<String>> getTypes() {
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 171, Column 19
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     166:     private JsonObject index;
     167:     private File folder;
     168: 
     169:     public NpmPackageFolder(String name) {
     170:       super();
>>>  171:       this.name = name;
     172:     }
     173: 
     174:     public Map<String, List<String>> getTypes() {
     175:       return types;
     176:     }
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 171, Column 7
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     166:     private JsonObject index;
     167:     private File folder;
     168: 
     169:     public NpmPackageFolder(String name) {
     170:       super();
>>>  171:       this.name = name;
     172:     }
     173: 
     174:     public Map<String, List<String>> getTypes() {
     175:       return types;
     176:     }
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 169, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     164:     private Map<String, List<String>> types = new HashMap<>();
     165:     private Map<String, byte[]> content = new HashMap<>();
     166:     private JsonObject index;
     167:     private File folder;
     168: 
>>>  169:     public NpmPackageFolder(String name) {
     170:       super();
     171:       this.name = name;
     172:     }
     173: 
     174:     public Map<String, List<String>> getTypes() {
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 28
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
     398:       gzipIn = new GzipCompressorInputStream(tgz);
     399:     } catch (Exception e) {
     400:       throw new IOException("Error reading "+(desc == null ? "package" : desc)+": "+e.getMessage(), e);
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     386:     return fromPackage(tgz, desc, false);
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
>>>  391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
>>>  392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 382, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     377:   }
     378: 
     379:   private static final int BUFFER_SIZE = 1024;
     380: 
     381:   public static @Nonnull NpmPackage fromPackage(InputStream tgz) throws IOException {
>>>  382:     return fromPackage(tgz, null, false);
     383:   }
     384: 
     385:   public static NpmPackage fromPackage(InputStream tgz, String desc) throws IOException {
     386:     return fromPackage(tgz, desc, false);
     387:   }
```

### Data Flow Step 16: org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java, Line 488, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java
```java
     483:     } else
     484:       return loadPackage(pi, loadInContext);
     485:   }
     486: 
     487:   private Map<String, byte[]> loadPackage(InputStream stream, String name, boolean loadInContext) throws FHIRException, IOException {
>>>  488:     return loadPackage(NpmPackage.fromPackage(stream), loadInContext);
     489:   }
     490: 
     491:   public Map<String, byte[]> loadPackage(NpmPackage pi, boolean loadInContext) throws FHIRException, IOException {
     492:     Map<String, byte[]> res = new HashMap<String, byte[]>();
     493:     for (String s : pi.dependencies()) {
```

### Data Flow Step 17: org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java, Line 491, Column 42
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java
```java
     486: 
     487:   private Map<String, byte[]> loadPackage(InputStream stream, String name, boolean loadInContext) throws FHIRException, IOException {
     488:     return loadPackage(NpmPackage.fromPackage(stream), loadInContext);
     489:   }
     490: 
>>>  491:   public Map<String, byte[]> loadPackage(NpmPackage pi, boolean loadInContext) throws FHIRException, IOException {
     492:     Map<String, byte[]> res = new HashMap<String, byte[]>();
     493:     for (String s : pi.dependencies()) {
     494:       if (s.endsWith(".x") && s.length() > 2) {
     495:         String packageMajorMinor = s.substring(0, s.length() - 2);
     496:         boolean found = false;
```

### Data Flow Step 18: org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java, Line 516, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java
```java
     511:       }
     512:     }
     513: 
     514:     if (loadInContext) {
     515: //      getContext().getLoadedPackages().add(pi.name() + "#" + pi.version());
>>>  516:       getContext().loadFromPackage(pi, ValidatorUtils.loaderForVersion(pi.fhirVersion()));
     517:     }
     518:     for (String s : pi.listResources("CodeSystem", "ConceptMap", "ImplementationGuide", "CapabilityStatement", "SearchParameter", "Conformance", "StructureMap", "ValueSet", "StructureDefinition")) {
     519:       res.put(s, TextFile.streamToBytes(pi.load("package", s)));
     520:     }
     521:     String ini = "[FHIR]\r\nversion=" + pi.fhirVersion() + "\r\n";
```

### Data Flow Step 19: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 422, Column 30
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     417: 		loadFromStream(new CSFileInputStream(path), loader);
     418: 	}
     419: 
     420: 
     421:   @Override
>>>  422:   public int loadFromPackage(NpmPackage pi, IContextResourceLoader loader) throws IOException, FHIRException {
     423:     return loadFromPackageInt(pi, loader, loader == null ? defaultTypesToLoad() : loader.getTypes());
     424:   }
     425: 
     426:   public static String[] defaultTypesToLoad() {
     427:     // there's no penalty for listing resources that don't exist, so we just all the relevant possibilities for all versions
```

### Data Flow Step 20: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 423, Column 31
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     418: 	}
     419: 
     420: 
     421:   @Override
     422:   public int loadFromPackage(NpmPackage pi, IContextResourceLoader loader) throws IOException, FHIRException {
>>>  423:     return loadFromPackageInt(pi, loader, loader == null ? defaultTypesToLoad() : loader.getTypes());
     424:   }
     425: 
     426:   public static String[] defaultTypesToLoad() {
     427:     // there's no penalty for listing resources that don't exist, so we just all the relevant possibilities for all versions
     428:     return new String[] {"CodeSystem", "ValueSet", "ConceptMap", "NamingSystem",
```

### Data Flow Step 21: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 460, Column 33
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     455:     t = t + loadFromPackageInt(pi, loader, loader.getTypes());
     456:     return t;
     457:   }
     458: 
     459: 
>>>  460:   public int loadFromPackageInt(NpmPackage pi, IContextResourceLoader loader, String... types) throws IOException, FHIRException {
     461:     int t = 0;
     462:     if (progress) {
     463:       System.out.println("Load Package "+pi.name()+"#"+pi.version());
     464:     }
     465:     if (loadedPackages.contains(pi.id()+"#"+pi.version())) {
```

### Data Flow Step 22: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 494, Column 45
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     489:       }
     490:     } else {
     491:       if (types.length == 0) {
     492:         types = new String[] { "StructureDefinition", "ValueSet", "CodeSystem", "SearchParameter", "OperationDefinition", "Questionnaire", "ConceptMap", "StructureMap", "NamingSystem", "Measures" };
     493:       }
>>>  494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
     495:         if (!pri.getFilename().contains("ig-r4")) {
     496:           try {
     497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
     498:             t++;
     499:           } catch (FHIRException e) {
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 561, Column 43
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     556:     }
     557:     Collections.sort(res);
     558:     return res;
     559:   }
     560: 
>>>  561:   public List<PackageResourceInformation> listIndexedResources(String... types) throws IOException {
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 563, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     558:     return res;
     559:   }
     560: 
     561:   public List<PackageResourceInformation> listIndexedResources(String... types) throws IOException {
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
>>>  563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
     567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 563, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     558:     return res;
     559:   }
     560: 
     561:   public List<PackageResourceInformation> listIndexedResources(String... types) throws IOException {
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
>>>  563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
     567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 563, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     558:     return res;
     559:   }
     560: 
     561:   public List<PackageResourceInformation> listIndexedResources(String... types) throws IOException {
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
>>>  563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
     567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 564, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     559:   }
     560: 
     561:   public List<PackageResourceInformation> listIndexedResources(String... types) throws IOException {
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
>>>  564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
     567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
     569:         }
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 80
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
     569:         }
     570:       }
     571:     }
     572:     //    Collections.sort(res, new PackageResourceInformationSorter());
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 178, Column 19
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     173: 
     174:     public Map<String, List<String>> getTypes() {
     175:       return types;
     176:     }
     177: 
>>>  178:     public String getName() {
     179:       return name;
     180:     }
     181: 
     182:     public boolean readIndex(JsonObject index) {
     183:       if (!index.has("index-version") || (index.asInteger("index-version") != NpmPackageIndexBuilder.CURRENT_INDEX_VERSION)) {
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 179, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     174:     public Map<String, List<String>> getTypes() {
     175:       return types;
     176:     }
     177: 
     178:     public String getName() {
>>>  179:       return name;
     180:     }
     181: 
     182:     public boolean readIndex(JsonObject index) {
     183:       if (!index.has("index-version") || (index.asInteger("index-version") != NpmPackageIndexBuilder.CURRENT_INDEX_VERSION)) {
     184:         return false;
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 179, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     174:     public Map<String, List<String>> getTypes() {
     175:       return types;
     176:     }
     177: 
     178:     public String getName() {
>>>  179:       return name;
     180:     }
     181: 
     182:     public boolean readIndex(JsonObject index) {
     183:       if (!index.has("index-version") || (index.asInteger("index-version") != NpmPackageIndexBuilder.CURRENT_INDEX_VERSION)) {
     184:         return false;
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 80
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
     569:         }
     570:       }
     571:     }
     572:     //    Collections.sort(res, new PackageResourceInformationSorter());
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
     569:         }
     570:       }
     571:     }
     572:     //    Collections.sort(res, new PackageResourceInformationSorter());
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 111, Column 39
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     106:     private String version;
     107:     private String filename;
     108:     private String supplements;
     109:     private String stype;
     110: 
>>>  111:     public PackageResourceInformation(String root, JsonObject fi) throws IOException {
     112:       super();
     113:       id = fi.asString("id");
     114:       resourceType = fi.asString("resourceType");
     115:       url = fi.asString("url");
     116:       version = fi.asString("version");
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 33
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     112:       super();
     113:       id = fi.asString("id");
     114:       resourceType = fi.asString("resourceType");
     115:       url = fi.asString("url");
     116:       version = fi.asString("version");
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
     118:       supplements = fi.asString("supplements");
     119:       stype = fi.asString("type");
     120:     }
     121:     public String getId() {
     122:       return id;
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     112:       super();
     113:       id = fi.asString("id");
     114:       resourceType = fi.asString("resourceType");
     115:       url = fi.asString("url");
     116:       version = fi.asString("version");
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
     118:       supplements = fi.asString("supplements");
     119:       stype = fi.asString("type");
     120:     }
     121:     public String getId() {
     122:       return id;
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     612:     s.append(src);
     613:     return s.toString();
     614:   }
     615: 
     616: 
>>>  617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
     622:       if (first && arg == null)
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     616: 
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
>>>  621:     for (String arg : args) {
     622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
>>>  622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 46: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 47: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 48: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     112:       super();
     113:       id = fi.asString("id");
     114:       resourceType = fi.asString("resourceType");
     115:       url = fi.asString("url");
     116:       version = fi.asString("version");
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
     118:       supplements = fi.asString("supplements");
     119:       stype = fi.asString("type");
     120:     }
     121:     public String getId() {
     122:       return id;
```

### Data Flow Step 49: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 7
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     112:       super();
     113:       id = fi.asString("id");
     114:       resourceType = fi.asString("resourceType");
     115:       url = fi.asString("url");
     116:       version = fi.asString("version");
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
     118:       supplements = fi.asString("supplements");
     119:       stype = fi.asString("type");
     120:     }
     121:     public String getId() {
     122:       return id;
```

### Data Flow Step 50: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 111, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     106:     private String version;
     107:     private String filename;
     108:     private String supplements;
     109:     private String stype;
     110: 
>>>  111:     public PackageResourceInformation(String root, JsonObject fi) throws IOException {
     112:       super();
     113:       id = fi.asString("id");
     114:       resourceType = fi.asString("resourceType");
     115:       url = fi.asString("url");
     116:       version = fi.asString("version");
```

### Data Flow Step 51: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 21
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
     569:         }
     570:       }
     571:     }
     572:     //    Collections.sort(res, new PackageResourceInformationSorter());
```

### Data Flow Step 52: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 13
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
     564:       if (folder.index != null) {
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
     568:           }
     569:         }
     570:       }
     571:     }
     572:     //    Collections.sort(res, new PackageResourceInformationSorter());
```

### Data Flow Step 53: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 573, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     568:           }
     569:         }
     570:       }
     571:     }
     572:     //    Collections.sort(res, new PackageResourceInformationSorter());
>>>  573:     return res;
     574:   }
     575: 
     576:   /**
     577:    * use the name from listResources()
     578:    *
```

### Data Flow Step 54: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 494, Column 45
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     489:       }
     490:     } else {
     491:       if (types.length == 0) {
     492:         types = new String[] { "StructureDefinition", "ValueSet", "CodeSystem", "SearchParameter", "OperationDefinition", "Questionnaire", "ConceptMap", "StructureMap", "NamingSystem", "Measures" };
     493:       }
>>>  494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
     495:         if (!pri.getFilename().contains("ig-r4")) {
     496:           try {
     497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
     498:             t++;
     499:           } catch (FHIRException e) {
```

### Data Flow Step 55: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 495, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     490:     } else {
     491:       if (types.length == 0) {
     492:         types = new String[] { "StructureDefinition", "ValueSet", "CodeSystem", "SearchParameter", "OperationDefinition", "Questionnaire", "ConceptMap", "StructureMap", "NamingSystem", "Measures" };
     493:       }
     494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
>>>  495:         if (!pri.getFilename().contains("ig-r4")) {
     496:           try {
     497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
     498:             t++;
     499:           } catch (FHIRException e) {
     500:             throw new FHIRException(formatMessage(I18nConstants.ERROR_READING__FROM_PACKAGE__, pri.getFilename(), pi.name(), pi.version(), e.getMessage()), e);
```

### Data Flow Step 56: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 497, Column 67
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     492:         types = new String[] { "StructureDefinition", "ValueSet", "CodeSystem", "SearchParameter", "OperationDefinition", "Questionnaire", "ConceptMap", "StructureMap", "NamingSystem", "Measures" };
     493:       }
     494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
     495:         if (!pri.getFilename().contains("ig-r4")) {
     496:           try {
>>>  497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
     498:             t++;
     499:           } catch (FHIRException e) {
     500:             throw new FHIRException(formatMessage(I18nConstants.ERROR_READING__FROM_PACKAGE__, pri.getFilename(), pi.name(), pi.version(), e.getMessage()), e);
     501:           }
     502:         }
```

### Data Flow Step 57: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 99, Column 34
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
      94:   public static class PackageResourceLoader extends CanonicalResourceProxy {
      95: 
      96:     private final String filename;
      97:     private final IContextResourceLoader loader;
      98: 
>>>   99:     public PackageResourceLoader(PackageResourceInformation pri, IContextResourceLoader loader) {
     100:       super(pri.getResourceType(), pri.getId(), loader == null ? pri.getUrl() :loader.patchUrl(pri.getUrl(), pri.getResourceType()), pri.getVersion());
     101:       this.filename = pri.getFilename();
     102:       this.loader = loader;
     103:     }
     104: 
```

### Data Flow Step 58: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 101, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
      96:     private final String filename;
      97:     private final IContextResourceLoader loader;
      98: 
      99:     public PackageResourceLoader(PackageResourceInformation pri, IContextResourceLoader loader) {
     100:       super(pri.getResourceType(), pri.getId(), loader == null ? pri.getUrl() :loader.patchUrl(pri.getUrl(), pri.getResourceType()), pri.getVersion());
>>>  101:       this.filename = pri.getFilename();
     102:       this.loader = loader;
     103:     }
     104: 
     105:     @Override
     106:     public CanonicalResource loadResource() {
```

### Data Flow Step 59: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 136, Column 19
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     131:       return url;
     132:     }
     133:     public String getVersion() {
     134:       return version;
     135:     }
>>>  136:     public String getFilename() {
     137:       return filename;
     138:     }
     139:     public String getSupplements() {
     140:       return supplements;
     141:     }
```

### Data Flow Step 60: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 137, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     132:     }
     133:     public String getVersion() {
     134:       return version;
     135:     }
     136:     public String getFilename() {
>>>  137:       return filename;
     138:     }
     139:     public String getSupplements() {
     140:       return supplements;
     141:     }
     142: 
```

### Data Flow Step 61: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 137, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     132:     }
     133:     public String getVersion() {
     134:       return version;
     135:     }
     136:     public String getFilename() {
>>>  137:       return filename;
     138:     }
     139:     public String getSupplements() {
     140:       return supplements;
     141:     }
     142: 
```

### Data Flow Step 62: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 101, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
      96:     private final String filename;
      97:     private final IContextResourceLoader loader;
      98: 
      99:     public PackageResourceLoader(PackageResourceInformation pri, IContextResourceLoader loader) {
     100:       super(pri.getResourceType(), pri.getId(), loader == null ? pri.getUrl() :loader.patchUrl(pri.getUrl(), pri.getResourceType()), pri.getVersion());
>>>  101:       this.filename = pri.getFilename();
     102:       this.loader = loader;
     103:     }
     104: 
     105:     @Override
     106:     public CanonicalResource loadResource() {
```

### Data Flow Step 63: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 101, Column 7
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
      96:     private final String filename;
      97:     private final IContextResourceLoader loader;
      98: 
      99:     public PackageResourceLoader(PackageResourceInformation pri, IContextResourceLoader loader) {
     100:       super(pri.getResourceType(), pri.getId(), loader == null ? pri.getUrl() :loader.patchUrl(pri.getUrl(), pri.getResourceType()), pri.getVersion());
>>>  101:       this.filename = pri.getFilename();
     102:       this.loader = loader;
     103:     }
     104: 
     105:     @Override
     106:     public CanonicalResource loadResource() {
```

### Data Flow Step 64: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 99, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
      94:   public static class PackageResourceLoader extends CanonicalResourceProxy {
      95: 
      96:     private final String filename;
      97:     private final IContextResourceLoader loader;
      98: 
>>>   99:     public PackageResourceLoader(PackageResourceInformation pri, IContextResourceLoader loader) {
     100:       super(pri.getResourceType(), pri.getId(), loader == null ? pri.getUrl() :loader.patchUrl(pri.getUrl(), pri.getResourceType()), pri.getVersion());
     101:       this.filename = pri.getFilename();
     102:       this.loader = loader;
     103:     }
     104: 
```

### Data Flow Step 65: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 497, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     492:         types = new String[] { "StructureDefinition", "ValueSet", "CodeSystem", "SearchParameter", "OperationDefinition", "Questionnaire", "ConceptMap", "StructureMap", "NamingSystem", "Measures" };
     493:       }
     494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
     495:         if (!pri.getFilename().contains("ig-r4")) {
     496:           try {
>>>  497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
     498:             t++;
     499:           } catch (FHIRException e) {
     500:             throw new FHIRException(formatMessage(I18nConstants.ERROR_READING__FROM_PACKAGE__, pri.getFilename(), pi.name(), pi.version(), e.getMessage()), e);
     501:           }
     502:         }
```

### Data Flow Step 66: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java, Line 341, Column 43
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java
```java
     336:   public void cacheResource(Resource r) throws FHIRException {
     337:     cacheResourceFromPackage(r, null);
     338:   }
     339: 
     340: 
>>>  341:   public void registerResourceFromPackage(CanonicalResourceProxy r, PackageInformation packageInfo) throws FHIRException {
     342:     PackageHackerR5.fixLoadedResource(r, packageInfo);
     343: 
     344:     synchronized (lock) {
     345:       if (packageInfo != null) {
     346:         packages.put(packageInfo.getVID(), packageInfo);
```

### Data Flow Step 67: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java, Line 372, Column 58
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java
```java
     367:             ex.fhirType()));
     368:       }
     369:       switch(r.getType()) {
     370:       case "StructureDefinition":
     371:         if ("1.4.0".equals(version)) {
>>>  372:           StructureDefinition sd = (StructureDefinition) r.getResource();
     373:           fixOldSD(sd);
     374:         }
     375:         structures.register(r, packageInfo);
     376:         break;
     377:       case "ValueSet":
```

### Data Flow Step 68: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java, Line 71, Column 30
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java
```java
      66: 
      67:     public boolean hasVersion() {
      68:       return version != null;
      69:     }
      70: 
>>>   71:     public CanonicalResource getResource() throws FHIRException {
      72:       if (resource == null) {
      73:         resource = loadResource();
      74:         if (resource instanceof CodeSystem) {
      75:           CodeSystemUtilities.crossLinkCodeSystem((CodeSystem) resource);
      76:         }
```

### Data Flow Step 69: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java, Line 73, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java
```java
      68:       return version != null;
      69:     }
      70: 
      71:     public CanonicalResource getResource() throws FHIRException {
      72:       if (resource == null) {
>>>   73:         resource = loadResource();
      74:         if (resource instanceof CodeSystem) {
      75:           CodeSystemUtilities.crossLinkCodeSystem((CodeSystem) resource);
      76:         }
      77:       }
      78:       return resource;
```

### Data Flow Step 70: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 106, Column 30
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     101:       this.filename = pri.getFilename();
     102:       this.loader = loader;
     103:     }
     104: 
     105:     @Override
>>>  106:     public CanonicalResource loadResource() {
     107:       try {
     108:         FileInputStream f = new FileInputStream(filename);
     109:         try  {
     110:           if (loader != null) {
     111:             return R5Hacker.fixR5BrokenResource((CanonicalResource) loader.loadResource(f, true));
```

### Data Flow Step 71: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 108, Column 49
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     103:     }
     104: 
     105:     @Override
     106:     public CanonicalResource loadResource() {
     107:       try {
>>>  108:         FileInputStream f = new FileInputStream(filename);
     109:         try  {
     110:           if (loader != null) {
     111:             return R5Hacker.fixR5BrokenResource((CanonicalResource) loader.loadResource(f, true));
     112:           } else {
     113:             return R5Hacker.fixR5BrokenResource((CanonicalResource) new JsonParser().parse(f));
```

### Data Flow Step 72: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 108, Column 49
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
     103:     }
     104: 
     105:     @Override
     106:     public CanonicalResource loadResource() {
     107:       try {
>>>  108:         FileInputStream f = new FileInputStream(filename);
     109:         try  {
     110:           if (loader != null) {
     111:             return R5Hacker.fixR5BrokenResource((CanonicalResource) loader.loadResource(f, true));
     112:           } else {
     113:             return R5Hacker.fixR5BrokenResource((CanonicalResource) new JsonParser().parse(f));
```

## Code Flow 3

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     404: 
     405:       int i = 0;
     406:       int c = 12;
     407:       while ((entry = (TarArchiveEntry) tarIn.getNextEntry()) != null) {
     408:         i++;
>>>  409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
     398:       gzipIn = new GzipCompressorInputStream(tgz);
     399:     } catch (Exception e) {
     400:       throw new IOException("Error reading "+(desc == null ? "package" : desc)+": "+e.getMessage(), e);
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     386:     return fromPackage(tgz, desc, false);
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
>>>  391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
>>>  392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 370, Column 22
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     365:     if (progress) {
     366:       log("Installing " + id + "#" + (version == null ? "?" : version) + " to the package cache");
     367:       log("  Fetching:");
     368:     }
     369: 
>>>  370:     NpmPackage npm = NpmPackage.fromPackage(packageTgzInputStream, sourceDesc, true);
     371: 
     372:     if (progress) {
     373:       log("");
     374:       logn("  Installing: ");
     375:     }
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 925, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     920:       if (!lockFile.isFile()) {
     921:         TextFile.stringToFile("", lockFile);
     922:       }
     923:     }
     924: 
>>>  925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
     930:           result = f.get();
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 930, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
>>>  930:           result = f.get();
     931:         } finally {
     932:           fileLock.release();
     933:         }
     934:         if (!lockFile.delete()) {
     935:           lockFile.deleteOnExit();
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 16: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 17: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 18: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 880, Column 40
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     875:     }
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
>>>  880:   public Map<String, NpmPackageFolder> getFolders() {
     881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
```

### Data Flow Step 19: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
     880:   public Map<String, NpmPackageFolder> getFolders() {
>>>  881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
     886:     if (!dir.exists()) {
```

### Data Flow Step 20: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
     880:   public Map<String, NpmPackageFolder> getFolders() {
>>>  881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
     886:     if (!dir.exists()) {
```

### Data Flow Step 21: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 22: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 26
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     612:     s.append(src);
     613:     return s.toString();
     614:   }
     615: 
     616: 
>>>  617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
     622:       if (first && arg == null)
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     616: 
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
>>>  621:     for (String arg : args) {
     622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
>>>  622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 407, Column 42
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
>>>  407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
     409:               TextFile.bytesToFile(cnt, fn);
     410:               size = size + cnt.length;
     411:               i++;
     412:               if (progress && i % 50 == 0) {
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 407, Column 27
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
>>>  407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
     409:               TextFile.bytesToFile(cnt, fn);
     410:               size = size + cnt.length;
     411:               i++;
     412:               if (progress && i % 50 == 0) {
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     612:     s.append(src);
     613:     return s.toString();
     614:   }
     615: 
     616: 
>>>  617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
     622:       if (first && arg == null)
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     616: 
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
>>>  621:     for (String arg : args) {
     622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
>>>  622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 46: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 47: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 48: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 49: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 50: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 51: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 52: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 407, Column 27
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
>>>  407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
     409:               TextFile.bytesToFile(cnt, fn);
     410:               size = size + cnt.length;
     411:               i++;
     412:               if (progress && i % 50 == 0) {
```

### Data Flow Step 53: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 409, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
>>>  409:               TextFile.bytesToFile(cnt, fn);
     410:               size = size + cnt.length;
     411:               i++;
     412:               if (progress && i % 50 == 0) {
     413:                 c++;
     414:                 logn(".");
```

### Data Flow Step 54: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 186, Column 48
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
     181:     byte[] read = new byte[512];
     182:     for (int i; -1 != (i = input.read(read)); r.write(read, 0, i));
     183:     return r.toByteArray();
     184:   }
     185: 
>>>  186:   public static void bytesToFile(byte[] bytes, String path) throws IOException {
     187:     File file = new CSFile(path);
     188:     OutputStream sw = new FileOutputStream(file);
     189:     sw.write(bytes);
     190:     sw.flush();
     191:     sw.close();
```

### Data Flow Step 55: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 187, Column 28
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
     182:     for (int i; -1 != (i = input.read(read)); r.write(read, 0, i));
     183:     return r.toByteArray();
     184:   }
     185: 
     186:   public static void bytesToFile(byte[] bytes, String path) throws IOException {
>>>  187:     File file = new CSFile(path);
     188:     OutputStream sw = new FileOutputStream(file);
     189:     sw.write(bytes);
     190:     sw.flush();
     191:     sw.close();
     192:   }
```

### Data Flow Step 56: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      42:  *
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
>>>   47:   public CSFile(String pathname) throws IOException {
      48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
```

### Data Flow Step 57: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
      47:   public CSFile(String pathname) throws IOException {
>>>   48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
      53: //      File f = new File(getParent());
```

### Data Flow Step 58: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
      47:   public CSFile(String pathname) throws IOException {
>>>   48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
      53: //      File f = new File(getParent());
```

### Data Flow Step 59: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 10
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      42:  *
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
>>>   47:   public CSFile(String pathname) throws IOException {
      48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
```

### Data Flow Step 60: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 187, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
     182:     for (int i; -1 != (i = input.read(read)); r.write(read, 0, i));
     183:     return r.toByteArray();
     184:   }
     185: 
     186:   public static void bytesToFile(byte[] bytes, String path) throws IOException {
>>>  187:     File file = new CSFile(path);
     188:     OutputStream sw = new FileOutputStream(file);
     189:     sw.write(bytes);
     190:     sw.flush();
     191:     sw.close();
     192:   }
```

### Data Flow Step 61: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 188, Column 44
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
     183:     return r.toByteArray();
     184:   }
     185: 
     186:   public static void bytesToFile(byte[] bytes, String path) throws IOException {
     187:     File file = new CSFile(path);
>>>  188:     OutputStream sw = new FileOutputStream(file);
     189:     sw.write(bytes);
     190:     sw.flush();
     191:     sw.close();
     192:   }
     193: 
```

## Code Flow 4

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     404: 
     405:       int i = 0;
     406:       int c = 12;
     407:       while ((entry = (TarArchiveEntry) tarIn.getNextEntry()) != null) {
     408:         i++;
>>>  409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     409:         String n = entry.getName();
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
>>>  414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
     419:         } else {
     420:           int count;
     421:           byte data[] = new byte[BUFFER_SIZE];
     422:           ByteArrayOutputStream fos = new ByteArrayOutputStream();
     423:           try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
     398:       gzipIn = new GzipCompressorInputStream(tgz);
     399:     } catch (Exception e) {
     400:       throw new IOException("Error reading "+(desc == null ? "package" : desc)+": "+e.getMessage(), e);
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     386:     return fromPackage(tgz, desc, false);
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
>>>  391:     res.readStream(tgz, desc, progress);
     392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     387:   }
     388: 
     389:   public static NpmPackage fromPackage(InputStream tgz, String desc, boolean progress) throws IOException {
     390:     NpmPackage res = new NpmPackage();
     391:     res.readStream(tgz, desc, progress);
>>>  392:     return res;
     393:   }
     394: 
     395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
     396:     GzipCompressorInputStream gzipIn;
     397:     try {
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 370, Column 22
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     365:     if (progress) {
     366:       log("Installing " + id + "#" + (version == null ? "?" : version) + " to the package cache");
     367:       log("  Fetching:");
     368:     }
     369: 
>>>  370:     NpmPackage npm = NpmPackage.fromPackage(packageTgzInputStream, sourceDesc, true);
     371: 
     372:     if (progress) {
     373:       log("");
     374:       logn("  Installing: ");
     375:     }
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 925, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     920:       if (!lockFile.isFile()) {
     921:         TextFile.stringToFile("", lockFile);
     922:       }
     923:     }
     924: 
>>>  925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
     930:           result = f.get();
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 930, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
>>>  930:           result = f.get();
     931:         } finally {
     932:           fileLock.release();
     933:         }
     934:         if (!lockFile.delete()) {
     935:           lockFile.deleteOnExit();
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
```

### Data Flow Step 16: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 17: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 18: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 880, Column 40
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     875:     }
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
>>>  880:   public Map<String, NpmPackageFolder> getFolders() {
     881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
```

### Data Flow Step 19: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
     880:   public Map<String, NpmPackageFolder> getFolders() {
>>>  881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
     886:     if (!dir.exists()) {
```

### Data Flow Step 20: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
     876:     return null;
     877:   }
     878: 
     879:   /** special case when playing around inside the package **/
     880:   public Map<String, NpmPackageFolder> getFolders() {
>>>  881:     return folders;
     882:   }
     883: 
     884:   public void save(File directory) throws IOException {
     885:     File dir = new File(Utilities.path(directory.getAbsolutePath(), name()));
     886:     if (!dir.exists()) {
```

### Data Flow Step 21: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 22: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 26
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     612:     s.append(src);
     613:     return s.toString();
     614:   }
     615: 
     616: 
>>>  617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
     622:       if (first && arg == null)
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     616: 
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
>>>  621:     for (String arg : args) {
     622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     617:   public static String path(String... args) throws IOException {
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
>>>  622:       if (first && arg == null)
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
>>>  650:       a = a.replace("\\", File.separator);
     651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
>>>  651:       a = a.replace("/", File.separator);
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
>>>  672:         s.append(a);
     673:     }
     674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
     673:     }
>>>  674:     return s.toString();
     675:   }
     676: 
     677:   private static boolean hasCTempDir() {
     678:     if (!System.getProperty("os.name").toLowerCase().contains("win")) {
     679:       return false;
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 405, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
     403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
     404:             if (!(new File(dir).exists()))
>>>  405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
     408:               byte[] cnt = fe.getValue();
     409:               TextFile.bytesToFile(cnt, fn);
     410:               size = size + cnt.length;
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 444, Column 38
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     439:           }
     440:       }
     441:     }
     442:   }
     443: 
>>>  444:   public static File createDirectory(String path) throws IOException {
     445:     new CSFile(path).mkdirs();
     446:     return new File(path);
     447:   }
     448: 
     449:   public static String changeFileExt(String name, String ext) {
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 445, Column 16
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     440:       }
     441:     }
     442:   }
     443: 
     444:   public static File createDirectory(String path) throws IOException {
>>>  445:     new CSFile(path).mkdirs();
     446:     return new File(path);
     447:   }
     448: 
     449:   public static String changeFileExt(String name, String ext) {
     450:     if (name.lastIndexOf('.') > -1)
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      42:  *
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
>>>   47:   public CSFile(String pathname) throws IOException {
      48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
      47:   public CSFile(String pathname) throws IOException {
>>>   48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
      53: //      File f = new File(getParent());
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
      47:   public CSFile(String pathname) throws IOException {
>>>   48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
      53: //      File f = new File(getParent());
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 10
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
      42:  *
      43:  */
      44: public class CSFile extends File {
      45:   private static final long serialVersionUID = -2017155765132460726L;
      46: 
>>>   47:   public CSFile(String pathname) throws IOException {
      48:     super(pathname);
      49: 
      50: //    if (exists() && getParent() != null)
      51: //    {
      52: //      String n = getName();
```

### Data Flow Step 46: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 445, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
     440:       }
     441:     }
     442:   }
     443: 
     444:   public static File createDirectory(String path) throws IOException {
>>>  445:     new CSFile(path).mkdirs();
     446:     return new File(path);
     447:   }
     448: 
     449:   public static String changeFileExt(String name, String ext) {
     450:     if (name.lastIndexOf('.') > -1)
```
