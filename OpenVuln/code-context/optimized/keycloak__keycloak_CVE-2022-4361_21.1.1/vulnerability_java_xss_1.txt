# Vulnerability: java/xss
## Message: Cross-site scripting vulnerability due to a [user-provided value](1).
Cross-site scripting vulnerability due to a [user-provided value](2).

## Code Flow 1

### Thread Flow 1

### Data Flow Step 1: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 112, Column 34
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  112:         java.io.InputStream is = entity.getContent();
```

**Intermediate code within method `getToken` (lines 113-113):**
```java
     113:         try {
     114:             tokenResponse = JsonSerialization.readValue(is, AccessTokenResponse.class);
```

### Data Flow Step 2: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 114, Column 57
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  114:             tokenResponse = JsonSerialization.readValue(is, AccessTokenResponse.class);
```

### Data Flow Step 3: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 78, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   78:     public static <T> T readValue(InputStream bytes, Class<T> type) throws IOException {
```

### Data Flow Step 4: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 79, Column 26
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   79:         return readValue(bytes, type, false);
```

### Data Flow Step 5: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 90, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   90:     public static <T> T readValue(InputStream bytes, Class<T> type, boolean replaceSystemProperties) throws IOException {
```

**Intermediate code within method `readValue` (lines 91-93):**
```java
      91:         if (replaceSystemProperties) {
      92:             return sysPropertiesAwareMapper.readValue(bytes, type);
      93:         } else {
      94:             return mapper.readValue(bytes, type);
```

### Data Flow Step 6: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 94, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   94:             return mapper.readValue(bytes, type);
```

### Data Flow Step 7: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 79, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   79:         return readValue(bytes, type, false);
```

### Data Flow Step 8: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 114, Column 29
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  114:             tokenResponse = JsonSerialization.readValue(is, AccessTokenResponse.class);
```

**Intermediate code within method `getToken` (lines 115-120):**
```java
     115:         } finally {
     116:             try {
     117:                 is.close();
     118:             } catch (java.io.IOException ignored) { }
     119:         }
     120: 
     121:     	return (tokenResponse);
```

### Data Flow Step 9: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 121, Column 14
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  121:     	return (tokenResponse);
```

### Data Flow Step 10: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 76, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   76:             atr = getToken(user, pw);
```

### Data Flow Step 11: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 77, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   77:             tokenString = atr.getToken();
```

### Data Flow Step 12: core/src/main/java/org/keycloak/representations/AccessTokenResponse.java, Line 81, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/representations/AccessTokenResponse.java
```java
>>>   81:     public String getToken() {
```

### Data Flow Step 13: core/src/main/java/org/keycloak/representations/AccessTokenResponse.java, Line 82, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/representations/AccessTokenResponse.java
```java
>>>   82:         return token;
```

### Data Flow Step 14: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 77, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   77:             tokenString = atr.getToken();
```

### Data Flow Step 15: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 77, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   77:             tokenString = atr.getToken();
```

### Data Flow Step 16: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 48, Column 24
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   48:     public AuthOutcome authenticate(HttpFacade exchange)  {
```

### Data Flow Step 17: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 218, Column 23
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  218:             outcome = authenticator.authenticate(facade);
```

**Intermediate code within method `bearerAuthentication` (lines 219-240):**
```java
     219:         }
     220: 
     221:         if (outcome == AuthOutcome.FAILED || outcome == AuthOutcome.NOT_ATTEMPTED) {
     222:             AuthChallenge challenge = authenticator.getChallenge();
     223:             log.fine("Authentication outcome: " + outcome);
     224:             boolean challengeSent = challenge.challenge(facade);
     225:             if (!challengeSent) {
     226:                 // Use some default status code
     227:                 facade.getResponse().setStatus(Response.Status.UNAUTHORIZED.getStatusCode());
     228:             }
     229: 
     230:             // Send response now (if not already sent)
     231:             if (!facade.isResponseFinished()) {
     232:                 facade.getResponse().end();
     233:             }
     234:             return;
     235:         } else {
     236:             if (verifySslFailed(facade, resolvedDeployment)) {
     237:                 return;
     238:             }
     239:         }
     240: 
     241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 18: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 19: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 141
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 20: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 21: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 54, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   54:     public String getTokenString() {
```

### Data Flow Step 22: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 23: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 24: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 25: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 108
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 26: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 15
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 27: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 28: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 28
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 29: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 30: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 31: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 32: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 33: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 56
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

**Intermediate code within method `propagateSecurityContext` (lines 247-250):**
```java
     247: 
     248:         // Not needed to do resteasy specifics as KeycloakSecurityContext can be always retrieved from SecurityContext by typecast SecurityContext.getUserPrincipal to KeycloakPrincipal
     249:         // ResteasyProviderFactory.pushContext(KeycloakSecurityContext.class, skSession);
     250: 
     251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 34: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 35: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 36: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 40
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 37: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 38: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 17
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 39: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 40: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 45
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 41: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 34
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 42: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 242, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  242:         handleAuthActions(facade, resolvedDeployment);
```

### Data Flow Step 43: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 295, Column 38
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  295:     protected void handleAuthActions(JaxrsHttpFacade facade, KeycloakDeployment deployment) {
```

### Data Flow Step 44: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 102
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 45: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 46: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 23
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 47: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 48: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 49: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 50: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 297, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  297:         if (authActionsHandler.handledRequest()) {
```

### Data Flow Step 51: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 54, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   54:     public boolean handledRequest() {
```

**Intermediate code within method `handledRequest` (lines 55-58):**
```java
      55:         log.debugv("AuthenticatedActionsValve.invoke {0}", facade.getRequest().getURI());
      56:         if (corsRequest()) return true;
      57:         String requestUri = facade.getRequest().getURI();
      58:         if (requestUri.endsWith(AdapterConstants.K_QUERY_BEARER_TOKEN)) {
      59:             queryBearerToken();
```

### Data Flow Step 52: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 59, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   59:             queryBearerToken();
```

### Data Flow Step 53: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 68, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   68:     protected void queryBearerToken()  {
```

**Intermediate code within method `queryBearerToken` (lines 69-73):**
```java
      69:         log.debugv("queryBearerToken {0}",facade.getRequest().getURI());
      70:         if (abortTokenResponse()) return;
      71:         facade.getResponse().setStatus(200);
      72:         facade.getResponse().setHeader("Content-Type", "text/plain");
      73:         try {
      74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 54: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 55: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 56: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 214, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  214:     public KeycloakSecurityContext getSecurityContext() {
```

### Data Flow Step 57: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 58: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 59: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 60: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 61, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   61:     public String getTokenString() {
```

### Data Flow Step 61: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 62: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 63: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 64: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

## Code Flow 2

### Thread Flow 1

### Data Flow Step 1: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 112, Column 34
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  112:         java.io.InputStream is = entity.getContent();
```

**Intermediate code within method `getToken` (lines 113-113):**
```java
     113:         try {
     114:             tokenResponse = JsonSerialization.readValue(is, AccessTokenResponse.class);
```

### Data Flow Step 2: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 114, Column 57
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  114:             tokenResponse = JsonSerialization.readValue(is, AccessTokenResponse.class);
```

### Data Flow Step 3: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 78, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   78:     public static <T> T readValue(InputStream bytes, Class<T> type) throws IOException {
```

### Data Flow Step 4: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 79, Column 26
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   79:         return readValue(bytes, type, false);
```

### Data Flow Step 5: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 90, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   90:     public static <T> T readValue(InputStream bytes, Class<T> type, boolean replaceSystemProperties) throws IOException {
```

**Intermediate code within method `readValue` (lines 91-93):**
```java
      91:         if (replaceSystemProperties) {
      92:             return sysPropertiesAwareMapper.readValue(bytes, type);
      93:         } else {
      94:             return mapper.readValue(bytes, type);
```

### Data Flow Step 6: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 94, Column 37
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   94:             return mapper.readValue(bytes, type);
```

### Data Flow Step 7: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 94, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   94:             return mapper.readValue(bytes, type);
```

### Data Flow Step 8: core/src/main/java/org/keycloak/util/JsonSerialization.java, Line 79, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/util/JsonSerialization.java
```java
>>>   79:         return readValue(bytes, type, false);
```

### Data Flow Step 9: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 114, Column 29
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  114:             tokenResponse = JsonSerialization.readValue(is, AccessTokenResponse.class);
```

**Intermediate code within method `getToken` (lines 115-120):**
```java
     115:         } finally {
     116:             try {
     117:                 is.close();
     118:             } catch (java.io.IOException ignored) { }
     119:         }
     120: 
     121:     	return (tokenResponse);
```

### Data Flow Step 10: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 121, Column 14
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>  121:     	return (tokenResponse);
```

### Data Flow Step 11: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 76, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   76:             atr = getToken(user, pw);
```

### Data Flow Step 12: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 77, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   77:             tokenString = atr.getToken();
```

### Data Flow Step 13: core/src/main/java/org/keycloak/representations/AccessTokenResponse.java, Line 81, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/representations/AccessTokenResponse.java
```java
>>>   81:     public String getToken() {
```

### Data Flow Step 14: core/src/main/java/org/keycloak/representations/AccessTokenResponse.java, Line 82, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/representations/AccessTokenResponse.java
```java
>>>   82:         return token;
```

### Data Flow Step 15: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 77, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   77:             tokenString = atr.getToken();
```

### Data Flow Step 16: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 77, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   77:             tokenString = atr.getToken();
```

### Data Flow Step 17: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 48, Column 24
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   48:     public AuthOutcome authenticate(HttpFacade exchange)  {
```

### Data Flow Step 18: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 218, Column 23
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  218:             outcome = authenticator.authenticate(facade);
```

**Intermediate code within method `bearerAuthentication` (lines 219-240):**
```java
     219:         }
     220: 
     221:         if (outcome == AuthOutcome.FAILED || outcome == AuthOutcome.NOT_ATTEMPTED) {
     222:             AuthChallenge challenge = authenticator.getChallenge();
     223:             log.fine("Authentication outcome: " + outcome);
     224:             boolean challengeSent = challenge.challenge(facade);
     225:             if (!challengeSent) {
     226:                 // Use some default status code
     227:                 facade.getResponse().setStatus(Response.Status.UNAUTHORIZED.getStatusCode());
     228:             }
     229: 
     230:             // Send response now (if not already sent)
     231:             if (!facade.isResponseFinished()) {
     232:                 facade.getResponse().end();
     233:             }
     234:             return;
     235:         } else {
     236:             if (verifySslFailed(facade, resolvedDeployment)) {
     237:                 return;
     238:             }
     239:         }
     240: 
     241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 19: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 20: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 141
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 21: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 22: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 54, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   54:     public String getTokenString() {
```

### Data Flow Step 23: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 24: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 25: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 26: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 108
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 27: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 15
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 28: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 29: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 28
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 30: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 31: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 32: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 33: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 34: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 56
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

**Intermediate code within method `propagateSecurityContext` (lines 247-250):**
```java
     247: 
     248:         // Not needed to do resteasy specifics as KeycloakSecurityContext can be always retrieved from SecurityContext by typecast SecurityContext.getUserPrincipal to KeycloakPrincipal
     249:         // ResteasyProviderFactory.pushContext(KeycloakSecurityContext.class, skSession);
     250: 
     251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 35: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 36: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 37: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 40
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 38: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 39: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 17
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 40: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 41: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 45
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 42: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 34
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 43: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 242, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  242:         handleAuthActions(facade, resolvedDeployment);
```

### Data Flow Step 44: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 295, Column 38
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  295:     protected void handleAuthActions(JaxrsHttpFacade facade, KeycloakDeployment deployment) {
```

### Data Flow Step 45: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 102
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 46: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 47: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 23
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 48: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 49: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 50: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 51: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 297, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  297:         if (authActionsHandler.handledRequest()) {
```

### Data Flow Step 52: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 54, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   54:     public boolean handledRequest() {
```

**Intermediate code within method `handledRequest` (lines 55-58):**
```java
      55:         log.debugv("AuthenticatedActionsValve.invoke {0}", facade.getRequest().getURI());
      56:         if (corsRequest()) return true;
      57:         String requestUri = facade.getRequest().getURI();
      58:         if (requestUri.endsWith(AdapterConstants.K_QUERY_BEARER_TOKEN)) {
      59:             queryBearerToken();
```

### Data Flow Step 53: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 59, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   59:             queryBearerToken();
```

### Data Flow Step 54: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 68, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   68:     protected void queryBearerToken()  {
```

### Data Flow Step 55: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 69, Column 43
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   69:         log.debugv("queryBearerToken {0}",facade.getRequest().getURI());
```

### Data Flow Step 56: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 69, Column 43
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   69:         log.debugv("queryBearerToken {0}",facade.getRequest().getURI());
```

**Intermediate code within method `queryBearerToken` (lines 70-73):**
```java
      70:         if (abortTokenResponse()) return;
      71:         facade.getResponse().setStatus(200);
      72:         facade.getResponse().setHeader("Content-Type", "text/plain");
      73:         try {
      74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 57: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 58: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 214, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  214:     public KeycloakSecurityContext getSecurityContext() {
```

### Data Flow Step 59: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 60: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 61: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 62: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 61, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   61:     public String getTokenString() {
```

**Intermediate code within method `getTokenString` (lines 62-62):**
```java
      62:         refreshExpiredToken(true);
      63:         return super.getTokenString();
```

### Data Flow Step 63: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 63, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   63:         return super.getTokenString();
```

### Data Flow Step 64: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 61, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   61:     public String getTokenString() {
```

### Data Flow Step 65: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 66: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 67: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 63, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   63:         return super.getTokenString();
```

### Data Flow Step 68: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 69: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

## Code Flow 3

### Thread Flow 1

### Data Flow Step 1: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 114, Column 54
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  114:             MultivaluedMap<String, String> headers = requestContext.getHeaders();
```

### Data Flow Step 2: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 115, Column 47
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  115:             return (headers == null) ? null : headers.get(name);
```

### Data Flow Step 3: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 115, Column 47
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  115:             return (headers == null) ? null : headers.get(name);
```

### Data Flow Step 4: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 115, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  115:             return (headers == null) ? null : headers.get(name);
```

### Data Flow Step 5: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 49, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   49:         List<String> authHeaders = exchange.getRequest().getHeaders("Authorization");
```

**Intermediate code within method `authenticate` (lines 50-57):**
```java
      50:         if (authHeaders == null || authHeaders.isEmpty()) {
      51:             log.debug("Authorization header not present");
      52:             challenge = challengeResponse(exchange, OIDCAuthenticationError.Reason.NO_AUTHORIZATION_HEADER, null, null);
      53:             return AuthOutcome.NOT_ATTEMPTED;
      54:         }
      55: 
      56:         tokenString = null;
      57:         for (String authHeader : authHeaders) {
      58:             String[] split = authHeader.trim().split("\\s+");
```

### Data Flow Step 6: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 58, Column 30
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   58:             String[] split = authHeader.trim().split("\\s+");
```

### Data Flow Step 7: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 58, Column 30
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   58:             String[] split = authHeader.trim().split("\\s+");
```

### Data Flow Step 8: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 58, Column 30
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   58:             String[] split = authHeader.trim().split("\\s+");
```

**Intermediate code within method `authenticate` (lines 59-60):**
```java
      59:             if (split.length != 2) continue;
      60:             if (!split[0].equalsIgnoreCase("Basic")) continue;
      61:             tokenString = split[1];
```

### Data Flow Step 9: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 61, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   61:             tokenString = split[1];
```

### Data Flow Step 10: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 61, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   61:             tokenString = split[1];
```

### Data Flow Step 11: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java, Line 48, Column 24
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BasicAuthRequestAuthenticator.java
```java
>>>   48:     public AuthOutcome authenticate(HttpFacade exchange)  {
```

### Data Flow Step 12: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 218, Column 23
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  218:             outcome = authenticator.authenticate(facade);
```

**Intermediate code within method `bearerAuthentication` (lines 219-240):**
```java
     219:         }
     220: 
     221:         if (outcome == AuthOutcome.FAILED || outcome == AuthOutcome.NOT_ATTEMPTED) {
     222:             AuthChallenge challenge = authenticator.getChallenge();
     223:             log.fine("Authentication outcome: " + outcome);
     224:             boolean challengeSent = challenge.challenge(facade);
     225:             if (!challengeSent) {
     226:                 // Use some default status code
     227:                 facade.getResponse().setStatus(Response.Status.UNAUTHORIZED.getStatusCode());
     228:             }
     229: 
     230:             // Send response now (if not already sent)
     231:             if (!facade.isResponseFinished()) {
     232:                 facade.getResponse().end();
     233:             }
     234:             return;
     235:         } else {
     236:             if (verifySslFailed(facade, resolvedDeployment)) {
     237:                 return;
     238:             }
     239:         }
     240: 
     241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 13: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 14: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 141
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 15: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 16: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 54, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   54:     public String getTokenString() {
```

### Data Flow Step 17: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 18: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 19: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 20: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 108
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 21: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 15
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 22: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 23: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 28
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 24: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 25: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 26: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 27: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 28: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 56
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

**Intermediate code within method `propagateSecurityContext` (lines 247-250):**
```java
     247: 
     248:         // Not needed to do resteasy specifics as KeycloakSecurityContext can be always retrieved from SecurityContext by typecast SecurityContext.getUserPrincipal to KeycloakPrincipal
     249:         // ResteasyProviderFactory.pushContext(KeycloakSecurityContext.class, skSession);
     250: 
     251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 29: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 30: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 31: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 40
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 32: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 33: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 17
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 34: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 35: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 45
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 36: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 34
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 37: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 242, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  242:         handleAuthActions(facade, resolvedDeployment);
```

### Data Flow Step 38: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 295, Column 38
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  295:     protected void handleAuthActions(JaxrsHttpFacade facade, KeycloakDeployment deployment) {
```

### Data Flow Step 39: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 102
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 40: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 41: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 23
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 42: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 43: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 44: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 45: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 297, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  297:         if (authActionsHandler.handledRequest()) {
```

### Data Flow Step 46: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 54, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   54:     public boolean handledRequest() {
```

**Intermediate code within method `handledRequest` (lines 55-58):**
```java
      55:         log.debugv("AuthenticatedActionsValve.invoke {0}", facade.getRequest().getURI());
      56:         if (corsRequest()) return true;
      57:         String requestUri = facade.getRequest().getURI();
      58:         if (requestUri.endsWith(AdapterConstants.K_QUERY_BEARER_TOKEN)) {
      59:             queryBearerToken();
```

### Data Flow Step 47: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 59, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   59:             queryBearerToken();
```

### Data Flow Step 48: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 68, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   68:     protected void queryBearerToken()  {
```

**Intermediate code within method `queryBearerToken` (lines 69-73):**
```java
      69:         log.debugv("queryBearerToken {0}",facade.getRequest().getURI());
      70:         if (abortTokenResponse()) return;
      71:         facade.getResponse().setStatus(200);
      72:         facade.getResponse().setHeader("Content-Type", "text/plain");
      73:         try {
      74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 49: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 50: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 51: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 214, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  214:     public KeycloakSecurityContext getSecurityContext() {
```

### Data Flow Step 52: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 53: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 54: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 55: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 61, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   61:     public String getTokenString() {
```

### Data Flow Step 56: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 57: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 58: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 59: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

## Code Flow 4

### Thread Flow 1

### Data Flow Step 1: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 114, Column 54
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  114:             MultivaluedMap<String, String> headers = requestContext.getHeaders();
```

### Data Flow Step 2: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 115, Column 47
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  115:             return (headers == null) ? null : headers.get(name);
```

### Data Flow Step 3: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 115, Column 47
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  115:             return (headers == null) ? null : headers.get(name);
```

### Data Flow Step 4: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 115, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  115:             return (headers == null) ? null : headers.get(name);
```

### Data Flow Step 5: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 67, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   67:         List<String> authHeaders = exchange.getRequest().getHeaders("Authorization");
```

**Intermediate code within method `authenticate` (lines 68-75):**
```java
      68:         if (authHeaders == null || authHeaders.isEmpty()) {
      69:             log.debug("Authorization header not present");
      70:             challenge = challengeResponse(exchange, OIDCAuthenticationError.Reason.NO_BEARER_TOKEN, null, null);
      71:             return AuthOutcome.NOT_ATTEMPTED;
      72:         }
      73: 
      74:         tokenString = null;
      75:         for (String authHeader : authHeaders) {
      76:             String[] split = authHeader.trim().split("\\s+");
```

### Data Flow Step 6: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 76, Column 30
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   76:             String[] split = authHeader.trim().split("\\s+");
```

### Data Flow Step 7: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 76, Column 30
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   76:             String[] split = authHeader.trim().split("\\s+");
```

### Data Flow Step 8: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 76, Column 30
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   76:             String[] split = authHeader.trim().split("\\s+");
```

**Intermediate code within method `authenticate` (lines 77-78):**
```java
      77:             if (split.length != 2) continue;
      78:             if (split[0].equalsIgnoreCase("Bearer")) {
      79:                 tokenString = split[1];
```

### Data Flow Step 9: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 79, Column 31
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   79:                 tokenString = split[1];
```

### Data Flow Step 10: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 79, Column 17
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   79:                 tokenString = split[1];
```

### Data Flow Step 11: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 66, Column 24
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   66:     public AuthOutcome authenticate(HttpFacade exchange)  {
```

### Data Flow Step 12: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 214, Column 31
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  214:         AuthOutcome outcome = authenticator.authenticate(facade);
```

**Intermediate code within method `bearerAuthentication` (lines 215-240):**
```java
     215: 
     216:         if (outcome == AuthOutcome.NOT_ATTEMPTED && resolvedDeployment.isEnableBasicAuth()) {
     217:             authenticator = new BasicAuthRequestAuthenticator(resolvedDeployment);
     218:             outcome = authenticator.authenticate(facade);
     219:         }
     220: 
     221:         if (outcome == AuthOutcome.FAILED || outcome == AuthOutcome.NOT_ATTEMPTED) {
     222:             AuthChallenge challenge = authenticator.getChallenge();
     223:             log.fine("Authentication outcome: " + outcome);
     224:             boolean challengeSent = challenge.challenge(facade);
     225:             if (!challengeSent) {
     226:                 // Use some default status code
     227:                 facade.getResponse().setStatus(Response.Status.UNAUTHORIZED.getStatusCode());
     228:             }
     229: 
     230:             // Send response now (if not already sent)
     231:             if (!facade.isResponseFinished()) {
     232:                 facade.getResponse().end();
     233:             }
     234:             return;
     235:         } else {
     236:             if (verifySslFailed(facade, resolvedDeployment)) {
     237:                 return;
     238:             }
     239:         }
     240: 
     241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 13: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 14: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 141
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 15: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 16: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 54, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   54:     public String getTokenString() {
```

### Data Flow Step 17: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 18: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java, Line 55, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/BearerTokenRequestAuthenticator.java
```java
>>>   55:         return tokenString;
```

### Data Flow Step 19: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 121
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

### Data Flow Step 20: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 108
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 21: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 15
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 22: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 23: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 28
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 24: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   51:         this.tokenString = tokenString;
```

### Data Flow Step 25: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 50, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   50:     public KeycloakSecurityContext(String tokenString, AccessToken token, String idTokenString, IDToken idToken) {
```

### Data Flow Step 26: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 48, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   48:         super(tokenString, token, idTokenString, idToken);
```

### Data Flow Step 27: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 47, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   47:     public RefreshableKeycloakSecurityContext(KeycloakDeployment deployment, AdapterTokenStore tokenStore, String tokenString, AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {
```

### Data Flow Step 28: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 246, Column 56
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  246:         RefreshableKeycloakSecurityContext skSession = new RefreshableKeycloakSecurityContext(resolvedDeployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);
```

**Intermediate code within method `propagateSecurityContext` (lines 247-250):**
```java
     247: 
     248:         // Not needed to do resteasy specifics as KeycloakSecurityContext can be always retrieved from SecurityContext by typecast SecurityContext.getUserPrincipal to KeycloakPrincipal
     249:         // ResteasyProviderFactory.pushContext(KeycloakSecurityContext.class, skSession);
     250: 
     251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 29: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 35
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 30: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 31: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 40
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 32: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 219, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  219:         this.keycloakSecurityContext = securityContext;
```

### Data Flow Step 33: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 218, Column 17
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  218:     public void setSecurityContext(KeycloakSecurityContext securityContext) {
```

### Data Flow Step 34: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 251, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  251:         facade.setSecurityContext(skSession);
```

### Data Flow Step 35: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 245, Column 45
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  245:     protected void propagateSecurityContext(JaxrsHttpFacade facade, ContainerRequestContext request, KeycloakDeployment resolvedDeployment, BearerTokenRequestAuthenticator bearer) {
```

### Data Flow Step 36: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 241, Column 34
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  241:         propagateSecurityContext(facade, request, resolvedDeployment, authenticator);
```

### Data Flow Step 37: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 242, Column 27
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  242:         handleAuthActions(facade, resolvedDeployment);
```

### Data Flow Step 38: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 295, Column 38
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  295:     protected void handleAuthActions(JaxrsHttpFacade facade, KeycloakDeployment deployment) {
```

### Data Flow Step 39: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 102
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 40: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 71
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 41: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 23
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 42: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 51, Column 9
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   51:         this.facade = facade;
```

### Data Flow Step 43: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 49, Column 12
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   49:     public AuthenticatedActionsHandler(KeycloakDeployment deployment, OIDCHttpFacade facade) {
```

### Data Flow Step 44: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 296, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  296:         AuthenticatedActionsHandler authActionsHandler = new AuthenticatedActionsHandler(deployment, facade);
```

### Data Flow Step 45: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java, Line 297, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsBearerTokenFilterImpl.java
```java
>>>  297:         if (authActionsHandler.handledRequest()) {
```

### Data Flow Step 46: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 54, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   54:     public boolean handledRequest() {
```

**Intermediate code within method `handledRequest` (lines 55-58):**
```java
      55:         log.debugv("AuthenticatedActionsValve.invoke {0}", facade.getRequest().getURI());
      56:         if (corsRequest()) return true;
      57:         String requestUri = facade.getRequest().getURI();
      58:         if (requestUri.endsWith(AdapterConstants.K_QUERY_BEARER_TOKEN)) {
      59:             queryBearerToken();
```

### Data Flow Step 47: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 59, Column 13
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   59:             queryBearerToken();
```

### Data Flow Step 48: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 68, Column 20
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   68:     protected void queryBearerToken()  {
```

### Data Flow Step 49: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 69, Column 43
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   69:         log.debugv("queryBearerToken {0}",facade.getRequest().getURI());
```

### Data Flow Step 50: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 69, Column 43
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   69:         log.debugv("queryBearerToken {0}",facade.getRequest().getURI());
```

**Intermediate code within method `queryBearerToken` (lines 70-73):**
```java
      70:         if (abortTokenResponse()) return;
      71:         facade.getResponse().setStatus(200);
      72:         facade.getResponse().setHeader("Content-Type", "text/plain");
      73:         try {
      74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 51: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 52: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 214, Column 36
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  214:     public KeycloakSecurityContext getSecurityContext() {
```

### Data Flow Step 53: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 54: adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java, Line 215, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/jaxrs-oauth-client/src/main/java/org/keycloak/jaxrs/JaxrsHttpFacade.java
```java
>>>  215:         return keycloakSecurityContext;
```

### Data Flow Step 55: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 56: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 61, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   61:     public String getTokenString() {
```

**Intermediate code within method `getTokenString` (lines 62-62):**
```java
      62:         refreshExpiredToken(true);
      63:         return super.getTokenString();
```

### Data Flow Step 57: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 63, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   63:         return super.getTokenString();
```

### Data Flow Step 58: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 61, Column 19
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   61:     public String getTokenString() {
```

### Data Flow Step 59: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 60: core/src/main/java/org/keycloak/KeycloakSecurityContext.java, Line 62, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/core/src/main/java/org/keycloak/KeycloakSecurityContext.java
```java
>>>   62:         return tokenString;
```

### Data Flow Step 61: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java, Line 63, Column 16
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/RefreshableKeycloakSecurityContext.java
```java
>>>   63:         return super.getTokenString();
```

### Data Flow Step 62: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```

### Data Flow Step 63: adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java, Line 74, Column 58
File: codeql-dbs/keycloak__keycloak_CVE-2022-4361_21.1.1/root/cwe-bench-java/project-sources/keycloak__keycloak_CVE-2022-4361_21.1.1/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/AuthenticatedActionsHandler.java
```java
>>>   74:             facade.getResponse().getOutputStream().write(facade.getSecurityContext().getTokenString().getBytes());
```
