# Vulnerability: java/xss
## Message: Cross-site scripting vulnerability due to a [user-provided value](1).

## Code Flow 1

### Thread Flow 1

### Data Flow Step 1: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 73
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
```

### Data Flow Step 2: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 61, Column 40
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   61: 	public static String getNextPathPart( String path, String lastPart ) throws ServletException {
```

**Intermediate code within method `getNextPathPart` (lines 62-76):**
```java
      62:         if( StringUtils.isBlank( path ) ) {
      63: 			return null;
      64: 		}
      65: 		if( !lastPart.endsWith( "/" ) ) {
      66: 			lastPart += "/";
      67: 		}
      68: 		final int lastPartLength =  lastPart.length();
      69: 		int index = path.indexOf( lastPart );
      70: 		if( index < 0 ) {
      71: 			lastPart = lastPart.substring( 0, lastPartLength - 1 );
      72: 			index = path.indexOf( lastPart );
      73: 			if( index < 0 ) {
      74: 				throw new ServletException( "Invalid path provided " + path + " does not contain '" + lastPart + "'" );
      75: 			}
      76: 		}
      77: 		path = path.substring( index + lastPartLength );
```

### Data Flow Step 3: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   77: 		path = path.substring( index + lastPartLength );
```

### Data Flow Step 4: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   77: 		path = path.substring( index + lastPartLength );
```

**Intermediate code within method `getNextPathPart` (lines 78-92):**
```java
      78: 		index = path.indexOf( "/" );
      79: 		if( index == -1 ) {
      80: 			index = path.indexOf( "#" );
      81: 			if( index == -1 ) {
      82: 				index = path.indexOf( "?" );
      83: 			}
      84: 		}
      85: 
      86: 		final String result;
      87: 		if( index == -1 ) {
      88: 			result = path;
      89:         } else {
      90:             result = path.substring( 0, index );
      91:         }
      92: 
      93:         return result;
```

### Data Flow Step 5: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 93, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   93:         return result;
```

### Data Flow Step 6: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 47
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
```

**Intermediate code within method `performAction` (lines 136-144):**
```java
     136:                     LOG.debug( "actionName=" + actionName );
     137:                     final String params = req.getParameter( "params" );
     138:                     LOG.debug( "params=" + params );
     139:                     List< String > paramValues = new ArrayList<>();
     140:                     if( params != null ) {
     141:                         if( StringUtils.isNotBlank( params ) ) {
     142:                             paramValues = Arrays.asList( params.trim().split( "," ) );
     143:                         }
     144:                     }
     145:                     servlet.service( req, res, actionName, paramValues );
```

### Data Flow Step 7: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 145, Column 48
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
>>>  145:                     servlet.service( req, res, actionName, paramValues );
```

### Data Flow Step 8: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 53, Column 93
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
>>>   53: 	public void service( final HttpServletRequest request, final HttpServletResponse response, final String actionName, final List< String > params )
```

**Intermediate code within method `service` (lines 54-58):**
```java
      54: 			throws ServletException, IOException {
      55: 		try {
      56: 			Thread.sleep( 5000 ); // Wait 5 seconds
      57: 		} catch( final Exception e ) {
      58: 		}
      59: 		response.getWriter().print( "You called! actionName=" + actionName + " params=" + params );
```

### Data Flow Step 9: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 59, Column 31
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
>>>   59: 		response.getWriter().print( "You called! actionName=" + actionName + " params=" + params );
```

## Code Flow 2

### Thread Flow 1

### Data Flow Step 1: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 73
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
```

### Data Flow Step 2: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 61, Column 40
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   61: 	public static String getNextPathPart( String path, String lastPart ) throws ServletException {
```

**Intermediate code within method `getNextPathPart` (lines 62-76):**
```java
      62:         if( StringUtils.isBlank( path ) ) {
      63: 			return null;
      64: 		}
      65: 		if( !lastPart.endsWith( "/" ) ) {
      66: 			lastPart += "/";
      67: 		}
      68: 		final int lastPartLength =  lastPart.length();
      69: 		int index = path.indexOf( lastPart );
      70: 		if( index < 0 ) {
      71: 			lastPart = lastPart.substring( 0, lastPartLength - 1 );
      72: 			index = path.indexOf( lastPart );
      73: 			if( index < 0 ) {
      74: 				throw new ServletException( "Invalid path provided " + path + " does not contain '" + lastPart + "'" );
      75: 			}
      76: 		}
      77: 		path = path.substring( index + lastPartLength );
```

### Data Flow Step 3: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   77: 		path = path.substring( index + lastPartLength );
```

### Data Flow Step 4: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 77, Column 10
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   77: 		path = path.substring( index + lastPartLength );
```

**Intermediate code within method `getNextPathPart` (lines 78-89):**
```java
      78: 		index = path.indexOf( "/" );
      79: 		if( index == -1 ) {
      80: 			index = path.indexOf( "#" );
      81: 			if( index == -1 ) {
      82: 				index = path.indexOf( "?" );
      83: 			}
      84: 		}
      85: 
      86: 		final String result;
      87: 		if( index == -1 ) {
      88: 			result = path;
      89:         } else {
      90:             result = path.substring( 0, index );
```

### Data Flow Step 5: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 90, Column 22
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   90:             result = path.substring( 0, index );
```

### Data Flow Step 6: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 90, Column 22
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   90:             result = path.substring( 0, index );
```

**Intermediate code within method `getNextPathPart` (lines 91-92):**
```java
      91:         }
      92: 
      93:         return result;
```

### Data Flow Step 7: jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java, Line 93, Column 16
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/AjaxUtil.java
```java
>>>   93:         return result;
```

### Data Flow Step 8: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 135, Column 47
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
>>>  135:                     final String actionName = AjaxUtil.getNextPathPart( req.getRequestURI(), servlet.getServletMapping() );
```

**Intermediate code within method `performAction` (lines 136-144):**
```java
     136:                     LOG.debug( "actionName=" + actionName );
     137:                     final String params = req.getParameter( "params" );
     138:                     LOG.debug( "params=" + params );
     139:                     List< String > paramValues = new ArrayList<>();
     140:                     if( params != null ) {
     141:                         if( StringUtils.isNotBlank( params ) ) {
     142:                             paramValues = Arrays.asList( params.trim().split( "," ) );
     143:                         }
     144:                     }
     145:                     servlet.service( req, res, actionName, paramValues );
```

### Data Flow Step 9: jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java, Line 145, Column 48
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/ajax/WikiAjaxDispatcherServlet.java
```java
>>>  145:                     servlet.service( req, res, actionName, paramValues );
```

### Data Flow Step 10: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 53, Column 93
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
>>>   53: 	public void service( final HttpServletRequest request, final HttpServletResponse response, final String actionName, final List< String > params )
```

**Intermediate code within method `service` (lines 54-58):**
```java
      54: 			throws ServletException, IOException {
      55: 		try {
      56: 			Thread.sleep( 5000 ); // Wait 5 seconds
      57: 		} catch( final Exception e ) {
      58: 		}
      59: 		response.getWriter().print( "You called! actionName=" + actionName + " params=" + params );
```

### Data Flow Step 11: jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java, Line 59, Column 31
File: codeql-dbs/apache__jspwiki_CVE-2022-46907_2.11.3/root/cwe-bench-java/project-sources/apache__jspwiki_CVE-2022-46907_2.11.3/jspwiki-main/src/main/java/org/apache/wiki/plugin/SampleAjaxPlugin.java
```java
>>>   59: 		response.getWriter().print( "You called! actionName=" + actionName + " params=" + params );
```
