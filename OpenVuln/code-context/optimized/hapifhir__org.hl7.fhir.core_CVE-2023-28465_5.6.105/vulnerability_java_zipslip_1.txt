# Vulnerability: java/zipslip
## Message: Unsanitized archive entry, which may contain '..', is used in a [file system operation](1).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](2).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](3).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](4).
Unsanitized archive entry, which may contain '..', is used in a [file system operation](5).

## Code Flow 1

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  409:         String n = entry.getName();
```

**Intermediate code within method `readStream` (lines 410-413):**
```java
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

**Intermediate code within method `readStream` (lines 415-417):**
```java
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  391:     res.readStream(tgz, desc, progress);
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  392:     return res;
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 370, Column 22
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  370:     NpmPackage npm = NpmPackage.fromPackage(packageTgzInputStream, sourceDesc, true);
```

**Intermediate code within method `addPackageToCache` (lines 371-385):**
```java
     371: 
     372:     if (progress) {
     373:       log("");
     374:       logn("  Installing: ");
     375:     }
     376: 
     377:     if (!suppressErrors && npm.name() == null || id == null || !id.equalsIgnoreCase(npm.name())) {
     378:       if (!id.equals("hl7.fhir.r5.core") && !id.equals("hl7.fhir.us.immds")) {// temporary work around
     379:         throw new IOException("Attempt to import a mis-identified package. Expected " + id + ", got " + npm.name());
     380:       }
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
     386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 925, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
```

**Intermediate code within method `doWithLock` (lines 926-929):**
```java
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
     930:           result = f.get();
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 930, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  930:           result = f.get();
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

**Intermediate code within method `addPackageToCache` (lines 387-401):**
```java
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
     392:           Utilities.createDirectory(packRoot);
     393:           try {
     394:             Utilities.clearDirectory(packRoot);
     395:           } catch (Throwable t) {
     396:             log("Unable to clear directory: "+packRoot+": "+t.getMessage()+" - this may cause problems later");
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 16: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 17: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 18: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 880, Column 40
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  880:   public Map<String, NpmPackageFolder> getFolders() {
```

### Data Flow Step 19: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  881:     return folders;
```

### Data Flow Step 20: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  881:     return folders;
```

### Data Flow Step 21: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 22: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 26
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  617:   public static String path(String... args) throws IOException {
```

**Intermediate code within method `path` (lines 618-620):**
```java
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  621:     for (String arg : args) {
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  622:       if (first && arg == null)
```

**Intermediate code within method `path` (lines 623-649):**
```java
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
     628:         s.append(File.separator);
     629:       String a = arg;
     630:       if (s.length() == 0) {
     631:         if ("[tmp]".equals(a)) {
     632:           if (hasCTempDir()) {
     633:             a = C_TEMP_DIR;
     634:           } else if (ToolGlobalSettings.hasTempPath()) {
     635:             a = ToolGlobalSettings.getTempPath();
     636:           } else {
     637:             a = System.getProperty("java.io.tmpdir");
     638:           }
     639:         } else if ("[user]".equals(a)) {
     640:           a = System.getProperty("user.home");
     641:         } else if (a.startsWith("[") && a.endsWith("]")) {
     642:           String ev = System.getenv(a.replace("[", "").replace("]", ""));
     643:           if (ev != null) {
     644:             a = ev;
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

**Intermediate code within method `path` (lines 652-671):**
```java
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
     657:           s = new StringBuilder(Paths.get(".").toAbsolutePath().normalize().toString());
     658:         } else {
     659:           String p = s.toString().substring(0, s.length() - 1);
     660:           if (!p.contains(File.separator)) {
     661:             s = new StringBuilder();
     662:           } else {
     663:             s = new StringBuilder(p.substring(0, p.lastIndexOf(File.separator)) + File.separator);
     664:           }
     665:         }
     666:         a = a.substring(3);
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

**Intermediate code within method `path` (lines 673-673):**
```java
     673:     }
     674:     return s.toString();
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

**Intermediate code within method `addPackageToCache` (lines 404-404):**
```java
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 405, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  405:               Utilities.createDirectory(dir);
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 444, Column 38
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  444:   public static File createDirectory(String path) throws IOException {
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 445, Column 16
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  445:     new CSFile(path).mkdirs();
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   47:   public CSFile(String pathname) throws IOException {
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   48:     super(pathname);
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   48:     super(pathname);
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 66, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   66:     if (exists())
```

## Code Flow 2

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  409:         String n = entry.getName();
```

**Intermediate code within method `readStream` (lines 410-413):**
```java
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

**Intermediate code within method `readStream` (lines 415-417):**
```java
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 49
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 169, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  169:     public NpmPackageFolder(String name) {
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 171, Column 19
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  171:       this.name = name;
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 171, Column 7
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  171:       this.name = name;
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 169, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  169:     public NpmPackageFolder(String name) {
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 28
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  391:     res.readStream(tgz, desc, progress);
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  392:     return res;
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 382, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  382:     return fromPackage(tgz, null, false);
```

### Data Flow Step 16: org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java, Line 488, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java
```java
>>>  488:     return loadPackage(NpmPackage.fromPackage(stream), loadInContext);
```

### Data Flow Step 17: org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java, Line 491, Column 42
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java
```java
>>>  491:   public Map<String, byte[]> loadPackage(NpmPackage pi, boolean loadInContext) throws FHIRException, IOException {
```

**Intermediate code within method `loadPackage` (lines 492-515):**
```java
     492:     Map<String, byte[]> res = new HashMap<String, byte[]>();
     493:     for (String s : pi.dependencies()) {
     494:       if (s.endsWith(".x") && s.length() > 2) {
     495:         String packageMajorMinor = s.substring(0, s.length() - 2);
     496:         boolean found = false;
     497:         for (int i = 0; i < getContext().getLoadedPackages().size() && !found; ++i) {
     498:           String loadedPackage = getContext().getLoadedPackages().get(i);
     499:           if (loadedPackage.startsWith(packageMajorMinor)) {
     500:             found = true;
     501:           }
     502:         }
     503:         if (found)
     504:           continue;
     505:       }
     506:       if (!getContext().getLoadedPackages().contains(s)) {
     507:         if (!VersionUtilities.isCorePackage(s)) {
     508:           System.out.println("+  .. load IG from " + s);
     509:           res.putAll(fetchByPackage(s, loadInContext));
     510:         }
     511:       }
     512:     }
     513: 
     514:     if (loadInContext) {
     515: //      getContext().getLoadedPackages().add(pi.name() + "#" + pi.version());
     516:       getContext().loadFromPackage(pi, ValidatorUtils.loaderForVersion(pi.fhirVersion()));
```

### Data Flow Step 18: org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java, Line 516, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/IgLoader.java
```java
>>>  516:       getContext().loadFromPackage(pi, ValidatorUtils.loaderForVersion(pi.fhirVersion()));
```

### Data Flow Step 19: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 422, Column 30
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  422:   public int loadFromPackage(NpmPackage pi, IContextResourceLoader loader) throws IOException, FHIRException {
```

### Data Flow Step 20: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 423, Column 31
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  423:     return loadFromPackageInt(pi, loader, loader == null ? defaultTypesToLoad() : loader.getTypes());
```

### Data Flow Step 21: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 460, Column 33
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  460:   public int loadFromPackageInt(NpmPackage pi, IContextResourceLoader loader, String... types) throws IOException, FHIRException {
```

**Intermediate code within method `loadFromPackageInt` (lines 461-493):**
```java
     461:     int t = 0;
     462:     if (progress) {
     463:       System.out.println("Load Package "+pi.name()+"#"+pi.version());
     464:     }
     465:     if (loadedPackages.contains(pi.id()+"#"+pi.version())) {
     466:       return 0;
     467:     }
     468: 
     469:     loadedPackages.add(pi.id()+"#"+pi.version());
     470:     if (packageTracker != null) {
     471:       packageTracker.packageLoaded(pi.id(), pi.version());
     472:     }
     473: 
     474:     if ((types == null || types.length == 0) &&  loader != null) {
     475:       types = loader.getTypes();
     476:     }
     477:     if (VersionUtilities.isR2Ver(pi.fhirVersion()) || !pi.canLazyLoad() || !allowLazyLoading) {
     478:       // can't lazy load R2 because of valueset/codesystem implementation
     479:       if (types.length == 0) {
     480:         types = new String[] { "StructureDefinition", "ValueSet", "SearchParameter", "OperationDefinition", "Questionnaire", "ConceptMap", "StructureMap", "NamingSystem" };
     481:       }
     482:       for (String s : pi.listResources(types)) {
     483:         try {
     484:           loadDefinitionItem(s, pi.load("package", s), loader, null, new PackageInformation(pi));
     485:           t++;
     486:         } catch (Exception e) {
     487:           throw new FHIRException(formatMessage(I18nConstants.ERROR_READING__FROM_PACKAGE__, s, pi.name(), pi.version(), e.getMessage()), e);
     488:         }
     489:       }
     490:     } else {
     491:       if (types.length == 0) {
     492:         types = new String[] { "StructureDefinition", "ValueSet", "CodeSystem", "SearchParameter", "OperationDefinition", "Questionnaire", "ConceptMap", "StructureMap", "NamingSystem", "Measures" };
     493:       }
     494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
```

### Data Flow Step 22: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 494, Column 45
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 561, Column 43
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  561:   public List<PackageResourceInformation> listIndexedResources(String... types) throws IOException {
```

**Intermediate code within method `listIndexedResources` (lines 562-562):**
```java
     562:     List<PackageResourceInformation> res = new ArrayList<PackageResourceInformation>();
     563:     for (NpmPackageFolder folder : folders.values()) {
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 563, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  563:     for (NpmPackageFolder folder : folders.values()) {
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 563, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  563:     for (NpmPackageFolder folder : folders.values()) {
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 563, Column 36
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  563:     for (NpmPackageFolder folder : folders.values()) {
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 564, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  564:       if (folder.index != null) {
```

**Intermediate code within method `listIndexedResources` (lines 565-566):**
```java
     565:         for (JsonObject fi : folder.index.getJsonObjects("files")) {
     566:           if (Utilities.existsInList(fi.asString("resourceType"), types)) {
     567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 80
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 178, Column 19
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  178:     public String getName() {
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 179, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  179:       return name;
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 179, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  179:       return name;
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 80
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 111, Column 39
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  111:     public PackageResourceInformation(String root, JsonObject fi) throws IOException {
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 33
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  617:   public static String path(String... args) throws IOException {
```

**Intermediate code within method `path` (lines 618-620):**
```java
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  621:     for (String arg : args) {
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  622:       if (first && arg == null)
```

**Intermediate code within method `path` (lines 623-649):**
```java
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
     628:         s.append(File.separator);
     629:       String a = arg;
     630:       if (s.length() == 0) {
     631:         if ("[tmp]".equals(a)) {
     632:           if (hasCTempDir()) {
     633:             a = C_TEMP_DIR;
     634:           } else if (ToolGlobalSettings.hasTempPath()) {
     635:             a = ToolGlobalSettings.getTempPath();
     636:           } else {
     637:             a = System.getProperty("java.io.tmpdir");
     638:           }
     639:         } else if ("[user]".equals(a)) {
     640:           a = System.getProperty("user.home");
     641:         } else if (a.startsWith("[") && a.endsWith("]")) {
     642:           String ev = System.getenv(a.replace("[", "").replace("]", ""));
     643:           if (ev != null) {
     644:             a = ev;
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

**Intermediate code within method `path` (lines 652-671):**
```java
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
     657:           s = new StringBuilder(Paths.get(".").toAbsolutePath().normalize().toString());
     658:         } else {
     659:           String p = s.toString().substring(0, s.length() - 1);
     660:           if (!p.contains(File.separator)) {
     661:             s = new StringBuilder();
     662:           } else {
     663:             s = new StringBuilder(p.substring(0, p.lastIndexOf(File.separator)) + File.separator);
     664:           }
     665:         }
     666:         a = a.substring(3);
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

**Intermediate code within method `path` (lines 673-673):**
```java
     673:     }
     674:     return s.toString();
```

### Data Flow Step 46: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 47: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 48: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
```

### Data Flow Step 49: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 117, Column 7
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  117:       filename = Utilities.path(root, fi.asString("filename"));
```

### Data Flow Step 50: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 111, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  111:     public PackageResourceInformation(String root, JsonObject fi) throws IOException {
```

### Data Flow Step 51: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 21
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
```

### Data Flow Step 52: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 567, Column 13
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  567:             res.add(new PackageResourceInformation(folder.folder == null ? "@"+folder.getName() : folder.folder.getAbsolutePath(), fi));
```

**Intermediate code within method `listIndexedResources` (lines 568-572):**
```java
     568:           }
     569:         }
     570:       }
     571:     }
     572:     //    Collections.sort(res, new PackageResourceInformationSorter());
     573:     return res;
```

### Data Flow Step 53: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 573, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  573:     return res;
```

### Data Flow Step 54: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 494, Column 45
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  494:       for (PackageResourceInformation pri : pi.listIndexedResources(types)) {
```

### Data Flow Step 55: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 495, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  495:         if (!pri.getFilename().contains("ig-r4")) {
```

**Intermediate code within method `loadFromPackageInt` (lines 496-496):**
```java
     496:           try {
     497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
```

### Data Flow Step 56: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 497, Column 67
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
```

### Data Flow Step 57: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 99, Column 34
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>   99:     public PackageResourceLoader(PackageResourceInformation pri, IContextResourceLoader loader) {
```

### Data Flow Step 58: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 101, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  101:       this.filename = pri.getFilename();
```

### Data Flow Step 59: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 136, Column 19
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  136:     public String getFilename() {
```

### Data Flow Step 60: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 137, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  137:       return filename;
```

### Data Flow Step 61: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 137, Column 14
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  137:       return filename;
```

### Data Flow Step 62: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 101, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  101:       this.filename = pri.getFilename();
```

### Data Flow Step 63: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 101, Column 7
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  101:       this.filename = pri.getFilename();
```

### Data Flow Step 64: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 99, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>   99:     public PackageResourceLoader(PackageResourceInformation pri, IContextResourceLoader loader) {
```

### Data Flow Step 65: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 497, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  497:             registerResourceFromPackage(new PackageResourceLoader(pri, loader), new PackageInformation(pi));
```

### Data Flow Step 66: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java, Line 341, Column 43
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java
```java
>>>  341:   public void registerResourceFromPackage(CanonicalResourceProxy r, PackageInformation packageInfo) throws FHIRException {
```

**Intermediate code within method `registerResourceFromPackage` (lines 342-371):**
```java
     342:     PackageHackerR5.fixLoadedResource(r, packageInfo);
     343: 
     344:     synchronized (lock) {
     345:       if (packageInfo != null) {
     346:         packages.put(packageInfo.getVID(), packageInfo);
     347:       }
     348:       if (r.getId() != null) {
     349:         Map<String, ResourceProxy> map = allResourcesById.get(r.getType());
     350:         if (map == null) {
     351:           map = new HashMap<String, ResourceProxy>();
     352:           allResourcesById.put(r.getType(), map);
     353:         }
     354:         if ((packageInfo == null || !packageInfo.isExamplesPackage()) || !map.containsKey(r.getId())) {
     355:           map.put(r.getId(), new ResourceProxy(r));
     356:         }
     357:       }
     358: 
     359:       String url = r.getUrl();
     360:       if (!allowLoadingDuplicates && hasResourceVersion(r.getType(), url, r.getVersion()) && !packageInfo.isHTO()) {
     361:         // spcial workaround for known problems with existing packages
     362:         if (Utilities.existsInList(url, "http://hl7.org/fhir/SearchParameter/example")) {
     363:           return;
     364:         }
     365:         CanonicalResource ex = fetchResourceWithException(r.getType(), url);
     366:         throw new DefinitionException(formatMessage(I18nConstants.DUPLICATE_RESOURCE_, url, r.getVersion(), ex.getVersion(),
     367:             ex.fhirType()));
     368:       }
     369:       switch(r.getType()) {
     370:       case "StructureDefinition":
     371:         if ("1.4.0".equals(version)) {
     372:           StructureDefinition sd = (StructureDefinition) r.getResource();
```

### Data Flow Step 67: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java, Line 372, Column 58
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/BaseWorkerContext.java
```java
>>>  372:           StructureDefinition sd = (StructureDefinition) r.getResource();
```

### Data Flow Step 68: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java, Line 71, Column 30
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java
```java
>>>   71:     public CanonicalResource getResource() throws FHIRException {
```

**Intermediate code within method `getResource` (lines 72-72):**
```java
      72:       if (resource == null) {
      73:         resource = loadResource();
```

### Data Flow Step 69: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java, Line 73, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/CanonicalResourceManager.java
```java
>>>   73:         resource = loadResource();
```

### Data Flow Step 70: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 106, Column 30
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  106:     public CanonicalResource loadResource() {
```

**Intermediate code within method `loadResource` (lines 107-107):**
```java
     107:       try {
     108:         FileInputStream f = new FileInputStream(filename);
```

### Data Flow Step 71: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 108, Column 49
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  108:         FileInputStream f = new FileInputStream(filename);
```

### Data Flow Step 72: org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java, Line 108, Column 49
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/context/SimpleWorkerContext.java
```java
>>>  108:         FileInputStream f = new FileInputStream(filename);
```

## Code Flow 3

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  409:         String n = entry.getName();
```

**Intermediate code within method `readStream` (lines 410-413):**
```java
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

**Intermediate code within method `readStream` (lines 415-417):**
```java
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  391:     res.readStream(tgz, desc, progress);
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  392:     return res;
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 370, Column 22
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  370:     NpmPackage npm = NpmPackage.fromPackage(packageTgzInputStream, sourceDesc, true);
```

**Intermediate code within method `addPackageToCache` (lines 371-385):**
```java
     371: 
     372:     if (progress) {
     373:       log("");
     374:       logn("  Installing: ");
     375:     }
     376: 
     377:     if (!suppressErrors && npm.name() == null || id == null || !id.equalsIgnoreCase(npm.name())) {
     378:       if (!id.equals("hl7.fhir.r5.core") && !id.equals("hl7.fhir.us.immds")) {// temporary work around
     379:         throw new IOException("Attempt to import a mis-identified package. Expected " + id + ", got " + npm.name());
     380:       }
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
     386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 925, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
```

**Intermediate code within method `doWithLock` (lines 926-929):**
```java
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
     930:           result = f.get();
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 930, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  930:           result = f.get();
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

**Intermediate code within method `addPackageToCache` (lines 387-401):**
```java
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
     392:           Utilities.createDirectory(packRoot);
     393:           try {
     394:             Utilities.clearDirectory(packRoot);
     395:           } catch (Throwable t) {
     396:             log("Unable to clear directory: "+packRoot+": "+t.getMessage()+" - this may cause problems later");
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 16: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 17: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 18: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 880, Column 40
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  880:   public Map<String, NpmPackageFolder> getFolders() {
```

### Data Flow Step 19: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  881:     return folders;
```

### Data Flow Step 20: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  881:     return folders;
```

### Data Flow Step 21: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 22: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 26
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  617:   public static String path(String... args) throws IOException {
```

**Intermediate code within method `path` (lines 618-620):**
```java
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  621:     for (String arg : args) {
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  622:       if (first && arg == null)
```

**Intermediate code within method `path` (lines 623-649):**
```java
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
     628:         s.append(File.separator);
     629:       String a = arg;
     630:       if (s.length() == 0) {
     631:         if ("[tmp]".equals(a)) {
     632:           if (hasCTempDir()) {
     633:             a = C_TEMP_DIR;
     634:           } else if (ToolGlobalSettings.hasTempPath()) {
     635:             a = ToolGlobalSettings.getTempPath();
     636:           } else {
     637:             a = System.getProperty("java.io.tmpdir");
     638:           }
     639:         } else if ("[user]".equals(a)) {
     640:           a = System.getProperty("user.home");
     641:         } else if (a.startsWith("[") && a.endsWith("]")) {
     642:           String ev = System.getenv(a.replace("[", "").replace("]", ""));
     643:           if (ev != null) {
     644:             a = ev;
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

**Intermediate code within method `path` (lines 652-671):**
```java
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
     657:           s = new StringBuilder(Paths.get(".").toAbsolutePath().normalize().toString());
     658:         } else {
     659:           String p = s.toString().substring(0, s.length() - 1);
     660:           if (!p.contains(File.separator)) {
     661:             s = new StringBuilder();
     662:           } else {
     663:             s = new StringBuilder(p.substring(0, p.lastIndexOf(File.separator)) + File.separator);
     664:           }
     665:         }
     666:         a = a.substring(3);
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

**Intermediate code within method `path` (lines 673-673):**
```java
     673:     }
     674:     return s.toString();
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

**Intermediate code within method `addPackageToCache` (lines 404-406):**
```java
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
     406:             for (Entry<String, byte[]> fe : e.getValue().getContent().entrySet()) {
     407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 407, Column 42
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 407, Column 27
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  617:   public static String path(String... args) throws IOException {
```

**Intermediate code within method `path` (lines 618-620):**
```java
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  621:     for (String arg : args) {
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  622:       if (first && arg == null)
```

**Intermediate code within method `path` (lines 623-649):**
```java
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
     628:         s.append(File.separator);
     629:       String a = arg;
     630:       if (s.length() == 0) {
     631:         if ("[tmp]".equals(a)) {
     632:           if (hasCTempDir()) {
     633:             a = C_TEMP_DIR;
     634:           } else if (ToolGlobalSettings.hasTempPath()) {
     635:             a = ToolGlobalSettings.getTempPath();
     636:           } else {
     637:             a = System.getProperty("java.io.tmpdir");
     638:           }
     639:         } else if ("[user]".equals(a)) {
     640:           a = System.getProperty("user.home");
     641:         } else if (a.startsWith("[") && a.endsWith("]")) {
     642:           String ev = System.getenv(a.replace("[", "").replace("]", ""));
     643:           if (ev != null) {
     644:             a = ev;
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 46: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

### Data Flow Step 47: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

**Intermediate code within method `path` (lines 652-671):**
```java
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
     657:           s = new StringBuilder(Paths.get(".").toAbsolutePath().normalize().toString());
     658:         } else {
     659:           String p = s.toString().substring(0, s.length() - 1);
     660:           if (!p.contains(File.separator)) {
     661:             s = new StringBuilder();
     662:           } else {
     663:             s = new StringBuilder(p.substring(0, p.lastIndexOf(File.separator)) + File.separator);
     664:           }
     665:         }
     666:         a = a.substring(3);
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
```

### Data Flow Step 48: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

### Data Flow Step 49: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

**Intermediate code within method `path` (lines 673-673):**
```java
     673:     }
     674:     return s.toString();
```

### Data Flow Step 50: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 51: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 52: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 407, Column 27
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  407:               String fn = Utilities.path(dir, Utilities.cleanFileName(fe.getKey()));
```

**Intermediate code within method `addPackageToCache` (lines 408-408):**
```java
     408:               byte[] cnt = fe.getValue();
     409:               TextFile.bytesToFile(cnt, fn);
```

### Data Flow Step 53: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 409, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  409:               TextFile.bytesToFile(cnt, fn);
```

### Data Flow Step 54: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 186, Column 48
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
>>>  186:   public static void bytesToFile(byte[] bytes, String path) throws IOException {
```

### Data Flow Step 55: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 187, Column 28
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
>>>  187:     File file = new CSFile(path);
```

### Data Flow Step 56: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   47:   public CSFile(String pathname) throws IOException {
```

### Data Flow Step 57: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   48:     super(pathname);
```

### Data Flow Step 58: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   48:     super(pathname);
```

### Data Flow Step 59: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 10
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   47:   public CSFile(String pathname) throws IOException {
```

### Data Flow Step 60: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 187, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
>>>  187:     File file = new CSFile(path);
```

### Data Flow Step 61: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java, Line 188, Column 44
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TextFile.java
```java
>>>  188:     OutputStream sw = new FileOutputStream(file);
```

## Code Flow 4

### Thread Flow 1

### Data Flow Step 1: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 409, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  409:         String n = entry.getName();
```

**Intermediate code within method `readStream` (lines 410-413):**
```java
     410:         if (n.contains("..")) {
     411:           throw new RuntimeException("Entry with an illegal name: " + n);
     412:         }
     413:         if (entry.isDirectory()) {
     414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 2: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

### Data Flow Step 3: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 414, Column 24
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  414:           String dir = n.substring(0, n.length()-1);
```

**Intermediate code within method `readStream` (lines 415-417):**
```java
     415:           if (dir.startsWith("package/")) {
     416:             dir = dir.substring(8);
     417:           }
     418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 4: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 5: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 6: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 418, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  418:           folders.put(dir, new NpmPackageFolder(dir));
```

### Data Flow Step 7: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 395, Column 15
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  395:   public void readStream(InputStream tgz, String desc, boolean progress) throws IOException {
```

### Data Flow Step 8: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 391, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  391:     res.readStream(tgz, desc, progress);
```

### Data Flow Step 9: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 392, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  392:     return res;
```

### Data Flow Step 10: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 370, Column 22
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  370:     NpmPackage npm = NpmPackage.fromPackage(packageTgzInputStream, sourceDesc, true);
```

**Intermediate code within method `addPackageToCache` (lines 371-385):**
```java
     371: 
     372:     if (progress) {
     373:       log("");
     374:       logn("  Installing: ");
     375:     }
     376: 
     377:     if (!suppressErrors && npm.name() == null || id == null || !id.equalsIgnoreCase(npm.name())) {
     378:       if (!id.equals("hl7.fhir.r5.core") && !id.equals("hl7.fhir.us.immds")) {// temporary work around
     379:         throw new IOException("Attempt to import a mis-identified package. Expected " + id + ", got " + npm.name());
     380:       }
     381:     }
     382:     if (version == null)
     383:       version = npm.version();
     384: 
     385:     String v = version;
     386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 11: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 12: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

### Data Flow Step 13: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 925, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  925:     public <T> T doWithLock(CacheLockFunction<T> f) throws FileNotFoundException, IOException {
```

**Intermediate code within method `doWithLock` (lines 926-929):**
```java
     926:       try (FileChannel channel = new RandomAccessFile(lockFile, "rw").getChannel()) {
     927:         final FileLock fileLock = channel.lock();
     928:         T result = null;
     929:         try {
     930:           result = f.get();
```

### Data Flow Step 14: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 930, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  930:           result = f.get();
```

### Data Flow Step 15: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 386, Column 57
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  386:     return new CacheLock(id + "#" + version).doWithLock(() -> {
```

**Intermediate code within method `addPackageToCache` (lines 387-401):**
```java
     387:       NpmPackage pck = null;
     388:       String packRoot = Utilities.path(cacheFolder, id + "#" + v);
     389:       try {
     390:         // ok, now we have a lock on it... check if something created it while we were waiting
     391:         if (!new File(packRoot).exists() || Utilities.existsInList(v, "current", "dev")) {
     392:           Utilities.createDirectory(packRoot);
     393:           try {
     394:             Utilities.clearDirectory(packRoot);
     395:           } catch (Throwable t) {
     396:             log("Unable to clear directory: "+packRoot+": "+t.getMessage()+" - this may cause problems later");
     397:           }
     398: 
     399:           int i = 0;
     400:           int c = 0;
     401:           int size = 0;
     402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 16: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 17: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 18: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 880, Column 40
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  880:   public Map<String, NpmPackageFolder> getFolders() {
```

### Data Flow Step 19: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  881:     return folders;
```

### Data Flow Step 20: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java, Line 881, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/NpmPackage.java
```java
>>>  881:     return folders;
```

### Data Flow Step 21: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 22: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 402, Column 52
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  402:           for (Entry<String, NpmPackageFolder> e : npm.getFolders().entrySet()) {
```

### Data Flow Step 23: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 26
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 24: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 25: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 131
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 26: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

### Data Flow Step 27: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 617, Column 29
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  617:   public static String path(String... args) throws IOException {
```

**Intermediate code within method `path` (lines 618-620):**
```java
     618:     StringBuilder s = new StringBuilder();
     619:     boolean d = false;
     620:     boolean first = true;
     621:     for (String arg : args) {
```

### Data Flow Step 28: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 621, Column 23
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  621:     for (String arg : args) {
```

### Data Flow Step 29: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 622, Column 20
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  622:       if (first && arg == null)
```

**Intermediate code within method `path` (lines 623-649):**
```java
     623:         continue;
     624:       first = false;
     625:       if (!d)
     626:         d = !noString(arg);
     627:       else if (!s.toString().endsWith(File.separator))
     628:         s.append(File.separator);
     629:       String a = arg;
     630:       if (s.length() == 0) {
     631:         if ("[tmp]".equals(a)) {
     632:           if (hasCTempDir()) {
     633:             a = C_TEMP_DIR;
     634:           } else if (ToolGlobalSettings.hasTempPath()) {
     635:             a = ToolGlobalSettings.getTempPath();
     636:           } else {
     637:             a = System.getProperty("java.io.tmpdir");
     638:           }
     639:         } else if ("[user]".equals(a)) {
     640:           a = System.getProperty("user.home");
     641:         } else if (a.startsWith("[") && a.endsWith("]")) {
     642:           String ev = System.getenv(a.replace("[", "").replace("]", ""));
     643:           if (ev != null) {
     644:             a = ev;
     645:           } else {
     646:             a = "null";
     647:           }
     648:         }
     649:       }
     650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 30: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 31: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 650, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  650:       a = a.replace("\\", File.separator);
```

### Data Flow Step 32: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

### Data Flow Step 33: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 651, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  651:       a = a.replace("/", File.separator);
```

**Intermediate code within method `path` (lines 652-671):**
```java
     652:       if (s.length() > 0 && a.startsWith(File.separator))
     653:         a = a.substring(File.separator.length());
     654: 
     655:       while (a.startsWith(".." + File.separator)) {
     656:         if (s.length() == 0) {
     657:           s = new StringBuilder(Paths.get(".").toAbsolutePath().normalize().toString());
     658:         } else {
     659:           String p = s.toString().substring(0, s.length() - 1);
     660:           if (!p.contains(File.separator)) {
     661:             s = new StringBuilder();
     662:           } else {
     663:             s = new StringBuilder(p.substring(0, p.lastIndexOf(File.separator)) + File.separator);
     664:           }
     665:         }
     666:         a = a.substring(3);
     667:       }
     668:       if ("..".equals(a)) {
     669:         int i = s.substring(0, s.length() - 1).lastIndexOf(File.separator);
     670:         s = new StringBuilder(s.substring(0, i + 1));
     671:       } else
     672:         s.append(a);
```

### Data Flow Step 34: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 18
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

### Data Flow Step 35: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 672, Column 9
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  672:         s.append(a);
```

**Intermediate code within method `path` (lines 673-673):**
```java
     673:     }
     674:     return s.toString();
```

### Data Flow Step 36: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 37: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 674, Column 12
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  674:     return s.toString();
```

### Data Flow Step 38: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 403, Column 95
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  403:             String dir = e.getKey().equals("package") ? Utilities.path(packRoot, "package") : Utilities.path(packRoot, "package", e.getKey());
```

**Intermediate code within method `addPackageToCache` (lines 404-404):**
```java
     404:             if (!(new File(dir).exists()))
     405:               Utilities.createDirectory(dir);
```

### Data Flow Step 39: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java, Line 405, Column 41
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/npm/FilesystemPackageCacheManager.java
```java
>>>  405:               Utilities.createDirectory(dir);
```

### Data Flow Step 40: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 444, Column 38
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  444:   public static File createDirectory(String path) throws IOException {
```

### Data Flow Step 41: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 445, Column 16
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  445:     new CSFile(path).mkdirs();
```

### Data Flow Step 42: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 17
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   47:   public CSFile(String pathname) throws IOException {
```

### Data Flow Step 43: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 11
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   48:     super(pathname);
```

### Data Flow Step 44: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 48, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   48:     super(pathname);
```

### Data Flow Step 45: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java, Line 47, Column 10
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/CSFile.java
```java
>>>   47:   public CSFile(String pathname) throws IOException {
```

### Data Flow Step 46: org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java, Line 445, Column 5
File: codeql-dbs/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/root/cwe-bench-java/project-sources/hapifhir__org.hl7.fhir.core_CVE-2023-28465_5.6.105/org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/Utilities.java
```java
>>>  445:     new CSFile(path).mkdirs();
```
